const express = require("express");
const cors = require("cors");
const path = require("path");

const { createClient } = require("@supabase/supabase-js"); // ğŸŸ¡ Supabase Adminìš©

const app = express();
app.use(cors());
app.use(express.json());

// ğŸŸ¡ gagl.html ìš”ì²­ ì‹œ í•´ë‹¹ íŒŒì¼ ë°˜í™˜
app.get("/gagl.html", (req, res) => {
    res.sendFile(path.join(__dirname, "gagl.html"));
});

// âœ… Supabase Admin client ì„¤ì • (íšŒì›íƒˆí‡´ìš©, ì ˆëŒ€ í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œê¸ˆì§€)
const supabaseAdmin = createClient(
    "https://piafesfywtvpachbfoxr.supabase.co", // í”„ë¡œì íŠ¸ URL
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpYWZlc2Z5d3R2cGFjaGJmb3hyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDc4NDAxOCwiZXhwIjoyMDYwMzYwMDE4fQ.inGkUGNirltn3arVtb3rPvLpzoxK28OCDOx04rAH0EE"           // ì„œë¹„ìŠ¤ ë¡¤ í‚¤
);

app.post("/get-user", async (req, res) => {
    const { ìœ ì €UID } = req.body;

    if (!ìœ ì €UID) {
        return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì €UID ëˆ„ë½" });
    }

    const { data: ìœ ì €, error } = await supabaseAdmin
        .from("users")
        .select("*")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    if (error || !ìœ ì €) {
        return res.status(404).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });
    }

    // âœ… ë§ˆë²•ì˜íŒ”ë ˆíŠ¸ ìë™ ì§€ì • ë¡œì§ ì¶”ê°€
    const ì´ë©”ì¼íŒ”ë ˆíŠ¸ë§µ = {
        "rkrmfrkt@gagl.com": "ê°€ê¸€",
        "johny87@gagl.com": "ë„¤ì˜¨ì‚¬ì¸",
        "pink@gagl.com": "í•‘í¬ì˜¤ì…˜",
        "1234qwer@gagl.com": "í™©í˜¼í•˜ëŠ˜",
        "saiha@gagl.com": "ì—ë©”ë„ë“œìˆ²",
        "009900@gagl.com": "ê²¨ìš¸",
        "naataa@gagl.com": "ë¯¼ì´ˆ",
        "sibasrigal1@gagl.com": "ë¸”ë¼ì„¬",
        "wlstjr1q2w@gagl.com": "ì§€ì˜¥",
    };

    const ìë™íŒ”ë ˆíŠ¸ = ì´ë©”ì¼íŒ”ë ˆíŠ¸ë§µ[ìœ ì €.ë¡œê·¸ì¸ì´ë©”ì¼];
    if (ìë™íŒ”ë ˆíŠ¸ && ìœ ì €.ë§ˆë²•ì˜íŒ”ë ˆíŠ¸ !== ìë™íŒ”ë ˆíŠ¸) {
        await supabaseAdmin
            .from("users")
            .update({ ë§ˆë²•ì˜íŒ”ë ˆíŠ¸: ìë™íŒ”ë ˆíŠ¸ })
            .eq("ìœ ì €UID", ìœ ì €UID);
        ìœ ì €.ë§ˆë²•ì˜íŒ”ë ˆíŠ¸ = ìë™íŒ”ë ˆíŠ¸; // í´ë¼ì´ì–¸íŠ¸ë¡œë„ ìµœì‹ ê°’ ë°˜ì˜
    }

    // const now = new Date();
    // const formatter = new Intl.DateTimeFormat("ko-KR", {
    //     weekday: "short",
    //     timeZone: "Asia/Seoul"
    // });
    // const parts = formatter.formatToParts(now);
    // const ìš”ì¼ = parts.find(p => p.type === "weekday")?.value;

    // if (ìš”ì¼ === "ì¼") {
    //     const { data: ì „ì²´í•©, error: í•©ê³„ì—ëŸ¬ } = await supabaseAdmin
    //         .from("users")
    //         .select("ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€");

    //     if (í•©ê³„ì—ëŸ¬ || !ì „ì²´í•©) {
    //         return res.status(500).json({ ì˜¤ë¥˜: "í«ë‹¨ê³„ ê³„ì‚° ì‹¤íŒ¨ (ì´í•© ì¡°íšŒ ì—ëŸ¬)" });
    //     }

    //     const ëˆ„ì ë°ë¯¸ì§€ì´í•© = ì „ì²´í•©
    //         .filter(u => u.ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€ > 0)
    //         .reduce((í•©, u) => í•© + Number(u.ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€), 0);

    //     let í«ë‹¨ê³„ = 0;
    //     if (ëˆ„ì ë°ë¯¸ì§€ì´í•© >= 99_999_999) {
    //         í«ë‹¨ê³„ = 3;
    //     } else if (ëˆ„ì ë°ë¯¸ì§€ì´í•© >= 9_999_999) {
    //         í«ë‹¨ê³„ = 2;
    //     } else if (ëˆ„ì ë°ë¯¸ì§€ì´í•© >= 999_999) {
    //         í«ë‹¨ê³„ = 1;
    //     }

    //     await supabaseAdmin
    //         .from("users")
    //         .update({ í«ë‹¨ê³„ })
    //         .neq("í«ë‹¨ê³„", í«ë‹¨ê³„);

    // await supabaseAdmin
    //     .from("users")
    //     .update({ ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€: 0 })
    //     .neq("ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€", 0); // 0ì´ ì•„ë‹Œ ìœ ì €ë§Œ ì—…ë°ì´íŠ¸ (ë¶ˆí•„ìš”í•œ ì“°ê¸° ë°©ì§€)

    //     const { data: ëŒ€í‘œìœ ì €, error: ë³´ìŠ¤ì—ëŸ¬ } = await supabaseAdmin
    //         .from("users")
    //         .select("ë³´ìŠ¤ë„˜ë²„")
    //         .not("ë³´ìŠ¤ë„˜ë²„", "is", null)
    //         .limit(1)
    //         .single();

    //     if (!ëŒ€í‘œìœ ì € || ë³´ìŠ¤ì—ëŸ¬) {
    //         return res.status(500).json({ ì˜¤ë¥˜: "ë³´ìŠ¤ë„˜ë²„ ì¡°íšŒ ì‹¤íŒ¨" });
    //     }

    //     const í˜„ì¬ë³´ìŠ¤ë²ˆí˜¸ = ëŒ€í‘œìœ ì €.ë³´ìŠ¤ë„˜ë²„ ?? 0;
    //     const ë‹¤ìŒë³´ìŠ¤ë²ˆí˜¸ = (í˜„ì¬ë³´ìŠ¤ë²ˆí˜¸ + 1) % 6;

    //     await supabaseAdmin
    //         .from("users")
    //         .update({ ë³´ìŠ¤ë„˜ë²„: ë‹¤ìŒë³´ìŠ¤ë²ˆí˜¸ })
    //         .neq("ë³´ìŠ¤ë„˜ë²„", ë‹¤ìŒë³´ìŠ¤ë²ˆí˜¸);
    // }

    const ì¥ë¹„ë§µ = {
        "ì¼ë°˜": { ì´ë¦„: "ë¦´ë¦¬íŠ¸ì˜ ë…ë‹ˆ", ê³µê²©ë ¥: 30 },
        "ë ˆì–´": { ì´ë¦„: "ë””ì•„ë¸”ë¡œì˜ ë¿”", ê³µê²©ë ¥: 63 },
        "ì‹ í™”": { ì´ë¦„: "ë ˆë¹„ì•„íƒ„ì˜ ë¹„ëŠ˜", ê³µê²©ë ¥: 132 },
        "ê³ ëŒ€": { ì´ë¦„: "ë²¨ì œë¶€ë¸Œì˜ ê¼¬ë¦¬", ê³µê²©ë ¥: 276 },
        "íƒœì´ˆ": { ì´ë¦„: "ì‚¬íƒ„ì˜ ë‚ ê°œ", ê³µê²©ë ¥: 576 },
        "íƒ€ë½": { ì´ë¦„: "ë£¨ì‹œí¼ì˜ ì‹¬ì¥", ê³µê²©ë ¥: 1200 },
    };

    const ê¸°ë¡ = ìœ ì €.í•©ì„±ê¸°ë¡ || {};
    const ì¥ë¹„ëª©ë¡ = ìœ ì €.ì¥ë¹„ëª©ë¡ || [];

    for (const [ë“±ê¸‰, { ì´ë¦„, ê³µê²©ë ¥ }] of Object.entries(ì¥ë¹„ë§µ)) {
        const í‚¤ = `${ì´ë¦„}|${ë“±ê¸‰}`;
        const í•©ì„±ìˆ˜ = ê¸°ë¡[í‚¤];

        if (í•©ì„±ìˆ˜ !== undefined) {
            const ëˆ„ì ê³µê²©ë ¥ = (í•©ì„±ìˆ˜ + 1) * ê³µê²©ë ¥;

            const ì¥ë¹„ = ì¥ë¹„ëª©ë¡.find(j => j.ì´ë¦„ === ì´ë¦„ && j.ë“±ê¸‰ === ë“±ê¸‰);
            if (ì¥ë¹„) {
                ì¥ë¹„.ê³µê²©ë ¥ = ëˆ„ì ê³µê²©ë ¥;
            }
        }
    }
    ìœ ì €.ì¥ë¹„ê³µê²©ë ¥ = ì¥ë¹„ëª©ë¡.reduce((í•©, j) => í•© + (j.ê³µê²©ë ¥ || 0), 0);

    ìœ ì €.ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥ê³„ì‚°(ìœ ì €);

    const { error: ì—…ë°ì´íŠ¸ì—ëŸ¬ } = await supabaseAdmin
        .from("users")
        .update({
            ì¥ë¹„ëª©ë¡,
            ì¥ë¹„ê³µê²©ë ¥: ìœ ì €.ì¥ë¹„ê³µê²©ë ¥,
            ìµœì¢…ê³µê²©ë ¥: ìœ ì €.ìµœì¢…ê³µê²©ë ¥,
            ë§ˆë²•ì˜íŒ”ë ˆíŠ¸: ìœ ì €.ë§ˆë²•ì˜íŒ”ë ˆíŠ¸ // ë‹¤ì‹œ í•œë²ˆ ì €ì¥í•´ë„ ë¬´ë°©
        })
        .eq("ìœ ì €UID", ìœ ì €UID);

    if (ì—…ë°ì´íŠ¸ì—ëŸ¬) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }

    return res.json({ ìœ ì €ë°ì´í„°: { ...ìœ ì € } });
});

app.post("/boss-ranking", async (req, res) => {
    try {
        const { ìœ ì €UID } = req.body;

        // âœ… ëª¨ë“  ìœ ì €ì˜ ëˆ„ì  ë°ë¯¸ì§€ í•©ì‚°
        const { data: ì „ì²´í•©, error: í•©ê³„ì—ëŸ¬ } = await supabaseAdmin
            .from("users")
            .select("ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€");

        if (í•©ê³„ì—ëŸ¬ || !ì „ì²´í•©) {
            return res.status(500).json({ ì˜¤ë¥˜: "ì´í•© ê³„ì‚° ì‹¤íŒ¨" });
        }

        const ëˆ„ì ë°ë¯¸ì§€ì´í•© = ì „ì²´í•©
            .filter(u => u.ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€ > 0)
            .reduce((í•©, u) => í•© + Number(u.ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€), 0);

        // âœ… ìƒìœ„ 10ëª… ì¡°íšŒ
        const { data: ìœ ì €ë“¤, error: ìœ ì €ì—ëŸ¬ } = await supabaseAdmin
            .from("users")
            .select("ìœ ì €ì•„ì´ë””, ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€, ìœ ì €UID")
            .gt("ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€", 0)
            .order("ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€", { ascending: false })

        // ë‚´ ìˆœìœ„ ê³„ì‚°
        const ë‚´ìˆœìœ„ = ìœ ì €ë“¤.findIndex(u => u.ìœ ì €UID === ìœ ì €UID);
        const ë‚´ì •ë³´ = ë‚´ìˆœìœ„ >= 0 ? {
            ìˆœìœ„: ë‚´ìˆœìœ„ + 1,
            ìœ ì €ì•„ì´ë””: ìœ ì €ë“¤[ë‚´ìˆœìœ„].ìœ ì €ì•„ì´ë””,
            ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€: ìœ ì €ë“¤[ë‚´ìˆœìœ„].ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€
        } : null;

        if (ìœ ì €ì—ëŸ¬) {
            return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
        }

        res.json({ ìˆœìœ„: ìœ ì €ë“¤, ëˆ„ì ë°ë¯¸ì§€ì´í•©, ë‚´ì •ë³´ });

    } catch (e) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }
});


app.post("/attack-boss", async (req, res) => {
    const { ìœ ì €ë°ì´í„°, ë³´ìŠ¤ì´ë¦„ } = req.body;
    const { ìœ ì €UID } = ìœ ì €ë°ì´í„°;
    const ì „íˆ¬ë¡œê·¸ = [];

    if (!ìœ ì €UID) return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì €UID ëˆ„ë½" });


    const now = new Date();
    const formatter = new Intl.DateTimeFormat("ko-KR", {
        weekday: "short",
        timeZone: "Asia/Seoul"
    });
    const parts = formatter.formatToParts(now);
    const ìš”ì¼ = parts.find(p => p.type === "weekday")?.value;

    if (ìš”ì¼ === "í† ") {
        return res.status(403).json({ ì˜¤ë¥˜: "ë³´ìŠ¤ê°€ ì ì  ë©€ì–´ì§‘ë‹ˆë‹¤" });
    }
    if (ìš”ì¼ === "ì¼") {
        return res.status(403).json({ ì˜¤ë¥˜: "ìƒˆë¡œìš´ ë³´ìŠ¤ì˜ ê°•ë¦¼ìœ¼ë¡œ ëŒ€ì§€ê°€ ê°ˆë¼ì§€ëŠ” ì¤‘ì…ë‹ˆë‹¤" });
    }

    const { data: ìœ ì €, error } = await supabaseAdmin
        .from("users")
        .select("*")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    if (error || !ìœ ì €) return res.status(404).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });

    let í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ = ìœ ì €.í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ ?? 0;
    if (í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ < 10) {
        return res.json({ ê²°ê³¼: "ë¶ˆê°€", ë©”ì‹œì§€: "ìŠ¤íƒœë¯¸ë„ˆ ë¶€ì¡±" });
    }

    const ì•”í¬ë¼ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ì•”í¬ë¼"] || 0;
    const ë°œë™í™•ë¥  = ì•”í¬ë¼ * 0.01;

    const ìŠ¤íƒœë¯¸ë„ˆê°ì†ŒëŸ‰ = Math.random() < ë°œë™í™•ë¥  ? 9 : 10;
    í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ -= ìŠ¤íƒœë¯¸ë„ˆê°ì†ŒëŸ‰;

    ìœ ì €.ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰ = (ìœ ì €.ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰ || 0) + 10;

    // ìœ ì € ì²´ë ¥ íšŒë³µ
    ìœ ì €.ë‚¨ì€ì²´ë ¥ = ìœ ì €.ìµœëŒ€ì²´ë ¥;
    let í˜„ì¬í„´ = 1;

    // âœ… ë³´ìŠ¤ ì´ë¦„ ë°˜ì˜
    const ë³´ìŠ¤ = {
        ì´ë¦„: ë³´ìŠ¤ì´ë¦„ || "BOSS",
        ì²´ë ¥: 9999999,
        ë°©ì–´ë ¥: 0
    };

    // âœ… ì „íˆ¬ì‹œë®¬ë ˆì´ì…˜ ë‹¨ í•œ ë²ˆë§Œ í˜¸ì¶œ
    const ì „íˆ¬ê²°ê³¼ = ì „íˆ¬ì‹œë®¬ë ˆì´ì…˜(ìœ ì €, ë³´ìŠ¤, ì „íˆ¬ë¡œê·¸, í˜„ì¬í„´, true); // ë³´ìŠ¤ì „: true

    const ëˆ„ì ë°ë¯¸ì§€ = ì „íˆ¬ë¡œê·¸.reduce((í•©, ë¡œê·¸) => {
        return ë¡œê·¸.íƒ€ì… === "ê³µê²©" ? í•© + Number(ë¡œê·¸.íš¨ê³¼) : í•©;
    }, 0);

    ìœ ì €.ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€ += ëˆ„ì ë°ë¯¸ì§€;
    ìœ ì €.ë‚¨ì€ì²´ë ¥ = ìœ ì €.ìµœëŒ€ì²´ë ¥;
    // ëˆ„ì  ë°ë¯¸ì§€ ì €ì¥
    await supabaseAdmin.from("users").update({
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ,
        ë‚¨ì€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
        ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰: ìœ ì €.ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰,
        ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€: ìœ ì €.ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€
    }).eq("ìœ ì €UID", ìœ ì €UID);

    return res.json({
        ê²°ê³¼: "ì™„ë£Œ",
        ëˆ„ì ë°ë¯¸ì§€,
        ìœ ì €ë°ì´í„°: {
            ...ìœ ì €,
            í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ,
            ë‚¨ì€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
            ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€: ìœ ì €.ë³´ìŠ¤ëˆ„ì ë°ë¯¸ì§€
        },
        ì „íˆ¬ë¡œê·¸
    });
});

app.post("/attack-normal", async (req, res) => {
    const { ìœ ì €ë°ì´í„° } = req.body;
    const { ìœ ì €UID, í˜„ì¬ì¸µ: í´ë¼ì´ì–¸íŠ¸ì¸µ } = ìœ ì €ë°ì´í„°;
    const ì „íˆ¬ë¡œê·¸ = [];
    if (!ìœ ì €UID) return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì €UID ëˆ„ë½" });

    const { data: ìœ ì € } = await supabaseAdmin
        .from("users")
        .select("*")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    let í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ = ìœ ì €.í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ ?? 1000;
    if (í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ <= 0) {
        return res.json({ ê²°ê³¼: "ë¶ˆê°€", ë©”ì‹œì§€: "ìŠ¤íƒœë¯¸ë„ˆê°€ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤." });
    }

    const ëª¨ë˜ì‹œê³„ê°œìˆ˜ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ëª¨ë˜ì‹œê³„"] || 0;

    // ì´ í™•ë¥  ê³„ì‚° (ì˜ˆ: 3ê°œë©´ 0.03%)
    const í™•ë¥  = ëª¨ë˜ì‹œê³„ê°œìˆ˜ * 0.001;

    // í™•ë¥  ì‹¤íŒ¨ ì‹œì—ë§Œ ìŠ¤íƒœë¯¸ë„ˆ ê°ì†Œ
    if (Math.random() > í™•ë¥ ) {
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ--;
    }

    ìœ ì €.ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰++;

    const ëª¬ìŠ¤í„° = ì¼ë°˜ì•…ë§ˆë¶ˆëŸ¬ì˜¤ê¸°(í´ë¼ì´ì–¸íŠ¸ì¸µ || 1);
    // ìœ ì €.ì¡°ìš°ê¸°ë¡ = ìœ ì €.ì¡°ìš°ê¸°ë¡ || {
    //     ì¼ë°˜: 0
    // };
    // ìœ ì €.ì¡°ìš°ê¸°ë¡["ì¼ë°˜"]++;

    const íšŒë³µì „ì²´ë ¥ = ìœ ì €.ë‚¨ì€ì²´ë ¥;
    const ì¶”ê°€íšŒë³µ = ì•„ì´ì–¸ë°”ë””íšŒë³µ(ìœ ì €);
    let í˜„ì¬í„´ = 0;

    if (ì¶”ê°€íšŒë³µ > 0) {
        ìœ ì €.ë‚¨ì€ì²´ë ¥ = Math.min(ìœ ì €.ìµœëŒ€ì²´ë ¥, íšŒë³µì „ì²´ë ¥ + ì¶”ê°€íšŒë³µ);

        ì „íˆ¬ë¡œê·¸.push({
            í„´: í˜„ì¬í„´,
            íƒ€ì…: "íšŒë³µ",  // íšŒë³µ íƒ€ì… ì¶”ê°€
            ìœ ì €ì•„ì´ë””: ìœ ì €.ìœ ì €ì•„ì´ë””,
            ìœ ì €ê³µê²©ë ¥: ìœ ì €.ê³µê²©ë ¥,
            ìœ ì €ìµœì¢…ê³µê²©ë ¥: ìœ ì €.ìµœì¢…ê³µê²©ë ¥,
            ìœ ì €ì²´ë ¥: ìœ ì €.ë‚¨ì€ì²´ë ¥,
            ìœ ì €ìµœëŒ€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
            ëª¬ìŠ¤í„°ì´ë¦„: ëª¬ìŠ¤í„°.ì´ë¦„,
            ëª¬ìŠ¤í„°ì²´ë ¥: ëª¬ìŠ¤í„°.ì²´ë ¥,
            ëª¬ìŠ¤í„°ìµœëŒ€ì²´ë ¥: ëª¬ìŠ¤í„°.ì²´ë ¥,
            ëª¬ìŠ¤í„°ë°©ì–´ë ¥: ëª¬ìŠ¤í„°.ë°©ì–´ë ¥,
            ì•„ì´ì½˜: ["ì•„ì´ì–¸ë°”ë””ì•„ì´ì½˜"],  // íšŒë³µ ìŠ¤í‚¬ ì•„ì´ì½˜
            íš¨ê³¼: `${ì¶”ê°€íšŒë³µ}`,  // "ì²´ë ¥ íšŒë³µ"ë§Œ í‘œì‹œ
        });
    }
    í˜„ì¬í„´++;

    const ì „íˆ¬ = ì „íˆ¬ì‹œë®¬ë ˆì´ì…˜(ìœ ì €, ëª¬ìŠ¤í„°, ì „íˆ¬ë¡œê·¸, í˜„ì¬í„´);

    if (ì „íˆ¬.ê²°ê³¼ === "íŒ¨ë°°") {
        const ìœ ì €ë³µêµ¬ = {
            ...ìœ ì €,
            ë‚¨ì€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
            í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ
        };

        await supabaseAdmin.from("users").update({
            ë‚¨ì€ì²´ë ¥: ìœ ì €ë³µêµ¬.ë‚¨ì€ì²´ë ¥,
            í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ,
            í˜„ì¬ì¸µ: í´ë¼ì´ì–¸íŠ¸ì¸µ,
            // ì¡°ìš°ê¸°ë¡: ìœ ì €.ì¡°ìš°ê¸°ë¡
        }).eq("ìœ ì €UID", ìœ ì €UID);

        return res.json({
            ê²°ê³¼: "íŒ¨ë°°",
            ëª¬ìŠ¤í„°,
            ìœ ì €ë‚¨ì€ì²´ë ¥: ì „íˆ¬.ìœ ì €ë‚¨ì€ì²´ë ¥,
            ìœ ì €ë°ì´í„°: ìœ ì €ë³µêµ¬,
            ì „íˆ¬ë¡œê·¸
        });
    }

    const ë³´ìƒ = ë³´ìƒê³„ì‚°(í´ë¼ì´ì–¸íŠ¸ì¸µ, ìœ ì €, ëª¬ìŠ¤í„°);
    ë³´ìƒ.ìˆ™ë ¨ë„ += ì¸ì‚¬ì´íŠ¸ì¶”ê°€ìˆ™ë ¨ë„(ìœ ì €);
    ë³´ìƒ.ê²½í—˜ì¹˜ = Math.floor(ë³´ìƒ.ê²½í—˜ì¹˜ * ì¸í…”ë¦¬ì „ìŠ¤ì¶”ê°€ê²½í—˜ì¹˜ë°°ìœ¨(ìœ ì €));
    ë³´ìƒ.ê³¨ë“œ = Math.floor(ë³´ìƒ.ê³¨ë“œ * íšë“ê¸ˆí™”ë°œêµ´(ìœ ì €));

    const ì¸ì‚¬ì´íŠ¸ë°œë™ = ì¸ì‚¬ì´íŠ¸ì¶”ê°€ìˆ™ë ¨ë„(ìœ ì €) > 0;
    const ì¸í…”ë¦¬ì „ìŠ¤ë°œë™ = ì¸í…”ë¦¬ì „ìŠ¤ì¶”ê°€ê²½í—˜ì¹˜ë°°ìœ¨(ìœ ì €) > 1;
    const ë°œêµ´ë°œë™ = íšë“ê¸ˆí™”ë°œêµ´(ìœ ì €) > 1;

    const ë ˆë²¨ì—… = ë ˆë²¨ì—…íŒì •(ìœ ì €.ê²½í—˜ì¹˜ + ë³´ìƒ.ê²½í—˜ì¹˜, ìœ ì €.ë ˆë²¨);
    const ë“œë ˆì¸ = ë“œë ˆì¸íšŒë³µ(ìœ ì €);

    if (ë“œë ˆì¸ > 0) {
        ì „íˆ¬ë¡œê·¸.push({
            í„´: "ì¢…ë£Œ", // ë§ˆì§€ë§‰ ì „íˆ¬ í„´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            íƒ€ì…: "íšŒë³µ",
            ìœ ì €ì•„ì´ë””: ìœ ì €.ìœ ì €ì•„ì´ë””,
            ìœ ì €ê³µê²©ë ¥: ìœ ì €.ê³µê²©ë ¥,
            ìœ ì €ìµœì¢…ê³µê²©ë ¥: ìœ ì €.ìµœì¢…ê³µê²©ë ¥,
            ìœ ì €ì²´ë ¥: Math.min(ìœ ì €.ìµœëŒ€ì²´ë ¥, ì „íˆ¬.ìœ ì €ë‚¨ì€ì²´ë ¥ + ë“œë ˆì¸),
            ìœ ì €ìµœëŒ€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
            ëª¬ìŠ¤í„°ì´ë¦„: ëª¬ìŠ¤í„°.ì´ë¦„,
            ëª¬ìŠ¤í„°ì²´ë ¥: ì „íˆ¬.ëª¬ìŠ¤í„°ë‚¨ì€ì²´ë ¥,
            ëª¬ìŠ¤í„°ìµœëŒ€ì²´ë ¥: ëª¬ìŠ¤í„°.ì²´ë ¥,
            ëª¬ìŠ¤í„°ë°©ì–´ë ¥: ëª¬ìŠ¤í„°.ë°©ì–´ë ¥,
            ì•„ì´ì½˜: ["ë“œë ˆì¸ì•„ì´ì½˜"],  // ë“œë ˆì¸ ì•„ì´ì½˜ í‘œì‹œ
            íš¨ê³¼: `${ë“œë ˆì¸}`  // íšŒë³µëŸ‰
        });
    }

    const ìƒˆìœ ì € = ì „íˆ¬ë³´ìƒë°˜ì˜(ìœ ì €, ë³´ìƒ, ë“œë ˆì¸, ë ˆë²¨ì—…, ì „íˆ¬.ìœ ì €ë‚¨ì€ì²´ë ¥);
    ìƒˆìœ ì €.í˜„ì¬ì¸µ = í´ë¼ì´ì–¸íŠ¸ì¸µ;

    const ë“œëìœ ë¬¼ = ìœ ë¬¼ë“œëíŒì •(ëª¬ìŠ¤í„°, ìœ ì €);
    if (ë“œëìœ ë¬¼) {
        ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡ = ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡ || {};
        ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡[ë“œëìœ ë¬¼] = (ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡[ë“œëìœ ë¬¼] || 0) + 1;
    }

    const ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥ê³„ì‚°(ìƒˆìœ ì €);
    ìƒˆìœ ì €.ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥;
    const ìµœëŒ€ì²´ë ¥ = ìµœëŒ€ì²´ë ¥ê³„ì‚°(ìƒˆìœ ì €);
    ìƒˆìœ ì €.ìµœëŒ€ì²´ë ¥ = ìµœëŒ€ì²´ë ¥;

    let ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„ = ë ˆì–´ëª¬ìŠ¤í„°ë“±ì¥íŒì •(ìœ ì €);

    if (ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„ && í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ === 0) {
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ++;
    }

    await supabaseAdmin.from("users").update({
        ë ˆë²¨: ìƒˆìœ ì €.ë ˆë²¨,
        ë ˆë²¨ê³µê²©ë ¥: ìƒˆìœ ì €.ë ˆë²¨ê³µê²©ë ¥,
        ìµœì¢…ê³µê²©ë ¥: ìµœì¢…ê³µê²©ë ¥,
        ê²½í—˜ì¹˜: ìƒˆìœ ì €.ê²½í—˜ì¹˜,
        ê³¨ë“œ: ìƒˆìœ ì €.ê³¨ë“œ,
        ìµœëŒ€ì²´ë ¥: ìƒˆìœ ì €.ìµœëŒ€ì²´ë ¥,
        ë‚¨ì€ì²´ë ¥: ìƒˆìœ ì €.ë‚¨ì€ì²´ë ¥,
        ìˆ™ë ¨ë„: ìƒˆìœ ì €.ìˆ™ë ¨ë„,
        í˜„ì¬ì¸µ: ìƒˆìœ ì €.í˜„ì¬ì¸µ,
        ìŠ¤í‚¬: ìƒˆìœ ì €.ìŠ¤í‚¬,
        ë²„ì „ì—…: ìƒˆìœ ì €.ë²„ì „ì—…,
        ìœ ë¬¼ëª©ë¡: ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡,
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ,
        ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰: ìœ ì €.ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰,
    }).eq("ìœ ì €UID", ìƒˆìœ ì €.ìœ ì €UID);


    return res.json({
        ê²°ê³¼: "ìŠ¹ë¦¬",
        ëª¬ìŠ¤í„°,
        ìœ ì €ë‚¨ì€ì²´ë ¥: ìƒˆìœ ì €.ë‚¨ì€ì²´ë ¥,
        ë³´ìƒ,
        ë ˆë²¨ì—…,
        íšŒë³µ: ë“œë ˆì¸,
        ì¶”ê°€ê³¨ë“œ: ë³´ìƒ.ì¶”ê°€ê³¨ë“œ || 0,
        ì¶”ê°€ìˆ™ë ¨ë„: ë³´ìƒ.ì¶”ê°€ìˆ™ë ¨ë„ || 0,
        ìœ ì €ë°ì´í„°: {
            ...ìƒˆìœ ì €,
            í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ
        },
        ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„,
        ì „íˆ¬ë¡œê·¸,
        ë“œëìœ ë¬¼,
        ìŠ¤í‚¬ë°œë™: {
            ì¸ì‚¬ì´íŠ¸: ì¸ì‚¬ì´íŠ¸ë°œë™,   // true/false
            ì¸í…”ë¦¬ì „ìŠ¤: ì¸í…”ë¦¬ì „ìŠ¤ë°œë™, // true/false
            ë°œêµ´: ë°œêµ´ë°œë™              // true/false
        }
    });
});

app.post("/attack-rare", async (req, res) => {
    const { ìœ ì €ë°ì´í„°, ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„ } = req.body;
    const { ìœ ì €UID, í˜„ì¬ì¸µ: í´ë¼ì´ì–¸íŠ¸ì¸µ } = ìœ ì €ë°ì´í„°;
    const ì „íˆ¬ë¡œê·¸ = [];

    if (!ìœ ì €UID || !ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„) {
        return res.status(400).json({ ì˜¤ë¥˜: "ì…ë ¥ê°’ ëˆ„ë½" });
    }

    const { data: ìœ ì € } = await supabaseAdmin
        .from("users")
        .select("*")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    let í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ = ìœ ì €.í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ ?? 1000;
    if (í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ <= 0) {
        return res.json({ ê²°ê³¼: "ë¶ˆê°€", ë©”ì‹œì§€: "âš ï¸ ìŠ¤íƒœë¯¸ë„ˆê°€ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤." });
    }

    const ëª¨ë˜ì‹œê³„ê°œìˆ˜ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ëª¨ë˜ì‹œê³„"] || 0;

    // ì´ í™•ë¥  ê³„ì‚° (ì˜ˆ: 3ê°œë©´ 0.03%)
    const í™•ë¥  = ëª¨ë˜ì‹œê³„ê°œìˆ˜ * 0.001;

    // í™•ë¥  ì‹¤íŒ¨ ì‹œì—ë§Œ ìŠ¤íƒœë¯¸ë„ˆ ê°ì†Œ
    if (Math.random() > í™•ë¥ ) {
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ--;
    }

    ìœ ì €.ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰++;

    const ëª¬ìŠ¤í„° = ë ˆì–´ì•…ë§ˆë¶ˆëŸ¬ì˜¤ê¸°(í´ë¼ì´ì–¸íŠ¸ì¸µ || 1, ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„);

    // âœ… ì¡°ìš°ê¸°ë¡ ê°±ì‹ 
    const íƒ€ì… = ëª¬ìŠ¤í„°.íƒ€ì… || "";
    ìœ ì €.ì¡°ìš°ê¸°ë¡ = ìœ ì €.ì¡°ìš°ê¸°ë¡ || {
        ì¼ë°˜: 0,
        ë ˆì–´: 0,
        ì‹ í™”: 0,
        ê³ ëŒ€: 0,
        íƒœì´ˆ: 0,
        íƒ€ë½: 0,
        í™©ê¸ˆ: 0,
        ê³„ì‹œ: 0 // ğŸ”¥ ìˆ™ê³ ë¸”ë¦°ìš© íƒ€ì… ì¶”ê°€
    };
    if (ìœ ì €.ì¡°ìš°ê¸°ë¡[íƒ€ì…] !== undefined) {
        ìœ ì €.ì¡°ìš°ê¸°ë¡[íƒ€ì…]++;
    }

    const íšŒë³µì „ì²´ë ¥ = ìœ ì €.ë‚¨ì€ì²´ë ¥;
    const ì¶”ê°€íšŒë³µ = ì•„ì´ì–¸ë°”ë””íšŒë³µ(ìœ ì €);
    let í˜„ì¬í„´ = 0;

    if (ì¶”ê°€íšŒë³µ > 0) {
        ìœ ì €.ë‚¨ì€ì²´ë ¥ = Math.min(ìœ ì €.ìµœëŒ€ì²´ë ¥, íšŒë³µì „ì²´ë ¥ + ì¶”ê°€íšŒë³µ);

        ì „íˆ¬ë¡œê·¸.push({
            í„´: í˜„ì¬í„´,
            íƒ€ì…: "íšŒë³µ",  // íšŒë³µ íƒ€ì… ì¶”ê°€
            ìœ ì €ì•„ì´ë””: ìœ ì €.ìœ ì €ì•„ì´ë””,
            ìœ ì €ê³µê²©ë ¥: ìœ ì €.ê³µê²©ë ¥,
            ìœ ì €ìµœì¢…ê³µê²©ë ¥: ìœ ì €.ìµœì¢…ê³µê²©ë ¥,
            ìœ ì €ì²´ë ¥: ìœ ì €.ë‚¨ì€ì²´ë ¥,
            ìœ ì €ìµœëŒ€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
            ëª¬ìŠ¤í„°ì´ë¦„: ëª¬ìŠ¤í„°.ì´ë¦„,
            ëª¬ìŠ¤í„°ì²´ë ¥: ëª¬ìŠ¤í„°.ì²´ë ¥,
            ëª¬ìŠ¤í„°ìµœëŒ€ì²´ë ¥: ëª¬ìŠ¤í„°.ì²´ë ¥,
            ëª¬ìŠ¤í„°ë°©ì–´ë ¥: ëª¬ìŠ¤í„°.ë°©ì–´ë ¥,
            ì•„ì´ì½˜: ["ì•„ì´ì–¸ë°”ë””ì•„ì´ì½˜"],  // íšŒë³µ ìŠ¤í‚¬ ì•„ì´ì½˜
            íš¨ê³¼: `${ì¶”ê°€íšŒë³µ}`,  // "ì²´ë ¥ íšŒë³µ"ë§Œ í‘œì‹œ
        });
    }
    í˜„ì¬í„´++;

    const ì „íˆ¬ = ì „íˆ¬ì‹œë®¬ë ˆì´ì…˜(ìœ ì €, ëª¬ìŠ¤í„°, ì „íˆ¬ë¡œê·¸, í˜„ì¬í„´);

    if (ì „íˆ¬.ê²°ê³¼ === "íŒ¨ë°°") {
        const ìœ ì €ë³µêµ¬ = {
            ...ìœ ì €,
            ë‚¨ì€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
            í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ
        };

        await supabaseAdmin.from("users").update({
            ë‚¨ì€ì²´ë ¥: ìœ ì €ë³µêµ¬.ë‚¨ì€ì²´ë ¥,
            í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ,
            í˜„ì¬ì¸µ: í´ë¼ì´ì–¸íŠ¸ì¸µ,
            ì¡°ìš°ê¸°ë¡: ìœ ì €.ì¡°ìš°ê¸°ë¡
        }).eq("ìœ ì €UID", ìœ ì €UID);

        return res.json({
            ê²°ê³¼: "íŒ¨ë°°",
            ëª¬ìŠ¤í„°,
            ìœ ì €ë‚¨ì€ì²´ë ¥: ì „íˆ¬.ìœ ì €ë‚¨ì€ì²´ë ¥,
            ìœ ì €ë°ì´í„°: ìœ ì €ë³µêµ¬,
            ì „íˆ¬ë¡œê·¸
        });
    }

    // âœ… ë³´ìƒ ê³„ì‚°
    const ë³´ìƒ = ë³´ìƒê³„ì‚°(í´ë¼ì´ì–¸íŠ¸ì¸µ, ìœ ì €, ëª¬ìŠ¤í„°);
    ë³´ìƒ.ìˆ™ë ¨ë„ += ì¸ì‚¬ì´íŠ¸ì¶”ê°€ìˆ™ë ¨ë„(ìœ ì €);
    ë³´ìƒ.ê²½í—˜ì¹˜ += Math.floor(ë³´ìƒ.ê²½í—˜ì¹˜ * ì¸í…”ë¦¬ì „ìŠ¤ì¶”ê°€ê²½í—˜ì¹˜ë°°ìœ¨(ìœ ì €));
    ë³´ìƒ.ê³¨ë“œ = Math.floor(ë³´ìƒ.ê³¨ë“œ * íšë“ê¸ˆí™”ë°œêµ´(ìœ ì €));

    const ì¸ì‚¬ì´íŠ¸ë°œë™ = ì¸ì‚¬ì´íŠ¸ì¶”ê°€ìˆ™ë ¨ë„(ìœ ì €) > 0;
    const ì¸í…”ë¦¬ì „ìŠ¤ë°œë™ = ì¸í…”ë¦¬ì „ìŠ¤ì¶”ê°€ê²½í—˜ì¹˜ë°°ìœ¨(ìœ ì €) > 1;
    const ë°œêµ´ë°œë™ = íšë“ê¸ˆí™”ë°œêµ´(ìœ ì €) > 1;

    const ë ˆë²¨ì—… = ë ˆë²¨ì—…íŒì •(ìœ ì €.ê²½í—˜ì¹˜ + ë³´ìƒ.ê²½í—˜ì¹˜, ìœ ì €.ë ˆë²¨);
    const ë“œë ˆì¸ = ë“œë ˆì¸íšŒë³µ(ìœ ì €);

    if (ë“œë ˆì¸ > 0) {
        ì „íˆ¬ë¡œê·¸.push({
            í„´: í˜„ì¬í„´, // ë§ˆì§€ë§‰ ì „íˆ¬ í„´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            íƒ€ì…: "íšŒë³µ",
            ìœ ì €ì•„ì´ë””: ìœ ì €.ìœ ì €ì•„ì´ë””,
            ìœ ì €ê³µê²©ë ¥: ìœ ì €.ê³µê²©ë ¥,
            ìœ ì €ìµœì¢…ê³µê²©ë ¥: ìœ ì €.ìµœì¢…ê³µê²©ë ¥,
            ìœ ì €ì²´ë ¥: Math.min(ìœ ì €.ìµœëŒ€ì²´ë ¥, ì „íˆ¬.ìœ ì €ë‚¨ì€ì²´ë ¥ + ë“œë ˆì¸),
            ìœ ì €ìµœëŒ€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
            ëª¬ìŠ¤í„°ì´ë¦„: ëª¬ìŠ¤í„°.ì´ë¦„,
            ëª¬ìŠ¤í„°ì²´ë ¥: ì „íˆ¬.ëª¬ìŠ¤í„°ë‚¨ì€ì²´ë ¥,
            ëª¬ìŠ¤í„°ìµœëŒ€ì²´ë ¥: ëª¬ìŠ¤í„°.ì²´ë ¥,
            ëª¬ìŠ¤í„°ë°©ì–´ë ¥: ëª¬ìŠ¤í„°.ë°©ì–´ë ¥,
            ì•„ì´ì½˜: ["ë“œë ˆì¸ì•„ì´ì½˜"],  // ë“œë ˆì¸ ì•„ì´ì½˜ í‘œì‹œ
            íš¨ê³¼: `${ë“œë ˆì¸}`  // íšŒë³µëŸ‰
        });
    }

    const ìƒˆìœ ì € = ì „íˆ¬ë³´ìƒë°˜ì˜(ìœ ì €, ë³´ìƒ, ë“œë ˆì¸, ë ˆë²¨ì—…, ì „íˆ¬.ìœ ì €ë‚¨ì€ì²´ë ¥);
    ìƒˆìœ ì €.í˜„ì¬ì¸µ = í´ë¼ì´ì–¸íŠ¸ì¸µ;

    // âœ… ë“œë ì¥ë¹„ íŒì •
    const ë“œëì¥ë¹„ = ì¥ë¹„ë“œëíŒì •(ëª¬ìŠ¤í„°, ìœ ì €);
    if (ë“œëì¥ë¹„) {
        ìƒˆìœ ì €.ì¥ë¹„ëª©ë¡ = ìƒˆìœ ì €.ì¥ë¹„ëª©ë¡ || [];
        ìƒˆìœ ì €.í•©ì„±ê¸°ë¡ = ìƒˆìœ ì €.í•©ì„±ê¸°ë¡ || {};
        const í‚¤ = `${ë“œëì¥ë¹„.ì´ë¦„}|${ë“œëì¥ë¹„.ë“±ê¸‰}`;
        const ê¸°ì¡´ = ìƒˆìœ ì €.ì¥ë¹„ëª©ë¡.find(j => j.ì´ë¦„ === ë“œëì¥ë¹„.ì´ë¦„ && j.ë“±ê¸‰ === ë“œëì¥ë¹„.ë“±ê¸‰);

        if (ê¸°ì¡´) {
            ìƒˆìœ ì €.í•©ì„±ê¸°ë¡[í‚¤] = (ìƒˆìœ ì €.í•©ì„±ê¸°ë¡[í‚¤] || 0) + 1;
            ê¸°ì¡´.ê³µê²©ë ¥ += ë“œëì¥ë¹„.ê³µê²©ë ¥;
            ìƒˆìœ ì €.ì¥ë¹„ê³µê²©ë ¥ += ë“œëì¥ë¹„.ê³µê²©ë ¥;
        } else {
            ìƒˆìœ ì €.ì¥ë¹„ëª©ë¡.push(ë“œëì¥ë¹„);
            ìƒˆìœ ì €.í•©ì„±ê¸°ë¡[í‚¤] = 0;
            ìƒˆìœ ì €.ì¥ë¹„ê³µê²©ë ¥ += ë“œëì¥ë¹„.ê³µê²©ë ¥;
        }

    }

    const ë“œëìœ ë¬¼ = ìœ ë¬¼ë“œëíŒì •(ëª¬ìŠ¤í„°, ìœ ì €);
    if (ë“œëìœ ë¬¼) {
        ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡ = ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡ || {};
        ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡[ë“œëìœ ë¬¼] = (ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡[ë“œëìœ ë¬¼] || 0) + 1;
    }

    const ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥ê³„ì‚°(ìƒˆìœ ì €);
    ìƒˆìœ ì €.ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥;
    const ìµœëŒ€ì²´ë ¥ = ìµœëŒ€ì²´ë ¥ê³„ì‚°(ìƒˆìœ ì €);
    ìƒˆìœ ì €.ìµœëŒ€ì²´ë ¥ = ìµœëŒ€ì²´ë ¥;

    let ìƒˆë¡œìš´ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„ = ë ˆì–´ëª¬ìŠ¤í„°ë“±ì¥íŒì •(ìœ ì €);
    if (ìƒˆë¡œìš´ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„ && í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ === 0) {
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ++;
    }

    await supabaseAdmin.from("users").update({
        ë ˆë²¨: ìƒˆìœ ì €.ë ˆë²¨,
        ë ˆë²¨ê³µê²©ë ¥: ìƒˆìœ ì €.ë ˆë²¨ê³µê²©ë ¥,
        ì¥ë¹„ê³µê²©ë ¥: ìƒˆìœ ì €.ì¥ë¹„ê³µê²©ë ¥,
        ìµœì¢…ê³µê²©ë ¥: ìµœì¢…ê³µê²©ë ¥,
        ê²½í—˜ì¹˜: ìƒˆìœ ì €.ê²½í—˜ì¹˜,
        ê³¨ë“œ: ìƒˆìœ ì €.ê³¨ë“œ,
        ìµœëŒ€ì²´ë ¥: ìµœëŒ€ì²´ë ¥,
        ë‚¨ì€ì²´ë ¥: ìƒˆìœ ì €.ë‚¨ì€ì²´ë ¥,
        ìˆ™ë ¨ë„: ìƒˆìœ ì €.ìˆ™ë ¨ë„,
        í˜„ì¬ì¸µ: ìƒˆìœ ì €.í˜„ì¬ì¸µ,
        ìŠ¤í‚¬: ìƒˆìœ ì €.ìŠ¤í‚¬,
        ì¡°ìš°ê¸°ë¡: ìƒˆìœ ì €.ì¡°ìš°ê¸°ë¡,
        í•©ì„±ê¸°ë¡: ìƒˆìœ ì €.í•©ì„±ê¸°ë¡,
        ì¥ë¹„ëª©ë¡: ìƒˆìœ ì €.ì¥ë¹„ëª©ë¡,
        ë²„ì „ì—…: ìƒˆìœ ì €.ë²„ì „ì—…,
        ìœ ë¬¼ëª©ë¡: ìƒˆìœ ì €.ìœ ë¬¼ëª©ë¡,
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ,
        ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰: ìœ ì €.ìŠ¤íƒœë¯¸ë„ˆì†Œëª¨ì´ëŸ‰,
    }).eq("ìœ ì €UID", ìœ ì €UID);


    return res.json({
        ê²°ê³¼: "ìŠ¹ë¦¬",
        ëª¬ìŠ¤í„°,
        ìœ ì €ë‚¨ì€ì²´ë ¥: ìƒˆìœ ì €.ë‚¨ì€ì²´ë ¥,
        ë³´ìƒ,
        ë ˆë²¨ì—…,
        íšŒë³µ: ë“œë ˆì¸,
        ë“œëì¥ë¹„,
        ì¶”ê°€ê³¨ë“œ: ë³´ìƒ.ì¶”ê°€ê³¨ë“œ || 0,
        ì¶”ê°€ìˆ™ë ¨ë„: ë³´ìƒ.ì¶”ê°€ìˆ™ë ¨ë„ || 0,
        ìœ ì €ë°ì´í„°: {
            ...ìƒˆìœ ì €,
            í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ
        },
        ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„: ìƒˆë¡œìš´ë ˆì–´ëª¬ìŠ¤í„°ì´ë¦„,
        ì „íˆ¬ë¡œê·¸,
        ë“œëìœ ë¬¼,
        ìŠ¤í‚¬ë°œë™: {
            ì¸ì‚¬ì´íŠ¸: ì¸ì‚¬ì´íŠ¸ë°œë™,   // true/false
            ì¸í…”ë¦¬ì „ìŠ¤: ì¸í…”ë¦¬ì „ìŠ¤ë°œë™, // true/false
            ë°œêµ´: ë°œêµ´ë°œë™              // true/false
        }
    });
});

app.post("/use-salad", async (req, res) => {
    const { ìœ ì €UID } = req.body;
    if (!ìœ ì €UID) return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì €UID ëˆ„ë½" });

    const { data: ìœ ì €, error } = await supabaseAdmin
        .from("users")
        .select("í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ, ìµœëŒ€ìŠ¤íƒœë¯¸ë„ˆ, ìœ ë¬¼ëª©ë¡")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    if (error || !ìœ ì €) return res.status(404).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });

    const ë³´ìœ  = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ìƒëŸ¬ë“œ"] || 0;
    if (ë³´ìœ  < 1) return res.status(400).json({ ì˜¤ë¥˜: "ìƒëŸ¬ë“œê°€ ì—†ìŠµë‹ˆë‹¤" });

    const íšŒë³µëŸ‰ = 60;
    const í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ = ìœ ì €.í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ ?? 0;
    const ìµœëŒ€ìŠ¤íƒœë¯¸ë„ˆ = ìœ ì €.ìµœëŒ€ìŠ¤íƒœë¯¸ë„ˆ ?? 1000;

    // âœ… ì´ˆê³¼í•  ê²½ìš° ê±°ë¶€
    if (í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ + íšŒë³µëŸ‰ > ìµœëŒ€ìŠ¤íƒœë¯¸ë„ˆ) {
        return res.status(400).json({ ì˜¤ë¥˜: "ìƒëŸ¬ë“œë¥¼ ë¨¹ê¸°ì—” ì´ë¦…ë‹ˆë‹¤" });
    }

    const ìƒˆìŠ¤íƒœë¯¸ë„ˆ = í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ + íšŒë³µëŸ‰;
    const ìœ ë¬¼ëª©ë¡ = { ...ìœ ì €.ìœ ë¬¼ëª©ë¡, ìƒëŸ¬ë“œ: ë³´ìœ  - 1 };

    await supabaseAdmin
        .from("users")
        .update({ í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ: ìƒˆìŠ¤íƒœë¯¸ë„ˆ, ìœ ë¬¼ëª©ë¡ })
        .eq("ìœ ì €UID", ìœ ì €UID);

    return res.json({
        ê²°ê³¼: "ì„±ê³µ",
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ: ìƒˆìŠ¤íƒœë¯¸ë„ˆ,
        ìœ ë¬¼ëª©ë¡
    });
});

app.post("/refresh-stamina", async (req, res) => {
    const { ìœ ì €UID } = req.body;
    if (!ìœ ì €UID) return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì €UID ëˆ„ë½" });

    // âœ… í˜„ì¬ í•œêµ­ ì‹œê°ì˜ 'ì‹œê°„ ì •ìˆ˜' ê³„ì‚° (0~23)
    const now = new Date();
    const formatter = new Intl.DateTimeFormat("ko-KR", {
        hour: "numeric",
        hour12: false,
        timeZone: "Asia/Seoul"
    });
    const parts = formatter.formatToParts(now);
    const í˜„ì¬ì‹œê°„ì •ìˆ˜ = Number(parts.find(p => p.type === "hour")?.value);

    // âœ… ìœ ì € ì •ë³´ ì¡°íšŒ
    const { data: ìœ ì €, error } = await supabaseAdmin
        .from("users")
        .select("*")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    if (error || !ìœ ì €) return res.status(404).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });

    const ì €ì¥ëœì‹œê°„ = ìœ ì €.ìŠ¤íƒœë¯¸ë„ˆê°±ì‹ ì‹œê°„ ?? í˜„ì¬ì‹œê°„ì •ìˆ˜;
    let í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ = ìœ ì €.í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ ?? 1000;
    const ìµœëŒ€ìŠ¤íƒœë¯¸ë„ˆ = ìœ ì €.ìµœëŒ€ìŠ¤íƒœë¯¸ë„ˆ ?? 1000;

    // âœ… ì‹œê°„ ì°¨ì´ ê³„ì‚° (ìì • ë„˜ì„ ê²½ìš° ë³´ì •)
    let ì‹œê°„ì°¨ì´ = í˜„ì¬ì‹œê°„ì •ìˆ˜ - ì €ì¥ëœì‹œê°„;
    if (ì‹œê°„ì°¨ì´ < 0) ì‹œê°„ì°¨ì´ += 24;

    // âœ… ìŠ¤íƒœë¯¸ë„ˆ íšŒë³µëŸ‰ ê³„ì‚° ë° ì ìš©
    const íšŒë³µëŸ‰ = ì‹œê°„ì°¨ì´ * 60;
    í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ = Math.min(í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ + íšŒë³µëŸ‰, ìµœëŒ€ìŠ¤íƒœë¯¸ë„ˆ);

    // âœ… DBì— ë°˜ì˜
    await supabaseAdmin.from("users").update({
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ,
        ìŠ¤íƒœë¯¸ë„ˆê°±ì‹ ì‹œê°„: í˜„ì¬ì‹œê°„ì •ìˆ˜
    }).eq("ìœ ì €UID", ìœ ì €UID);

    // âœ… ì‘ë‹µ ë°˜í™˜
    return res.json({
        ìœ ì €ë°ì´í„°: {
            ...ìœ ì €,
            í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ,
            ìŠ¤íƒœë¯¸ë„ˆê°±ì‹ ì‹œê°„: í˜„ì¬ì‹œê°„ì •ìˆ˜
        }
    });
});

app.post("/upgrade-item", async (req, res) => {
    const { ìœ ì €UID, ì´ë¦„, ë“±ê¸‰ } = req.body;

    if (!ìœ ì €UID || !ì´ë¦„ || !ë“±ê¸‰) {
        return res.status(400).json({ ì˜¤ë¥˜: "í•„ìˆ˜ ê°’ ëˆ„ë½ë¨" });
    }

    // ìœ ì € ì •ë³´ ì¡°íšŒ
    const { data: ìœ ì €, error } = await supabaseAdmin
        .from("users")
        .select("*")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    if (error || !ìœ ì €) {
        return res.status(404).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨" });
    }

    const ì¥ë¹„ëª©ë¡ = ìœ ì €.ì¥ë¹„ëª©ë¡ || [];
    const ëŒ€ìƒ = ì¥ë¹„ëª©ë¡.find(j => j.ì´ë¦„ === ì´ë¦„ && j.ë“±ê¸‰ === ë“±ê¸‰);

    if (!ëŒ€ìƒ) {
        return res.status(404).json({ ì˜¤ë¥˜: "ì¥ë¹„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ" });
    }

    const ê°•í™”ë¹„ìš©ë§µ = {
        "ì¼ë°˜": 10000,
        "ë ˆì–´": 30000,
        "ì‹ í™”": 100000,
        "ê³ ëŒ€": 200000,
        "íƒœì´ˆ": 300000,
        "íƒ€ë½": 400000,
    };

    const ê°•í™”ë¹„ìš© = ê°•í™”ë¹„ìš©ë§µ[ë“±ê¸‰];
    if (typeof ê°•í™”ë¹„ìš© !== "number") {
        return res.status(400).json({ ì˜¤ë¥˜: "ì•Œ ìˆ˜ ì—†ëŠ” ë“±ê¸‰" });
    }

    if ((ìœ ì €.ê³¨ë“œ || 0) < ê°•í™”ë¹„ìš©) {
        return res.status(400).json({ ì˜¤ë¥˜: `ê³¨ë“œ ë¶€ì¡±: ${ê°•í™”ë¹„ìš©} í•„ìš”` });
    }

    const ëª¨ë£¨ê°œìˆ˜ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ëª¨ë£¨"] || 0;

    let ì¦ê°€ëŸ‰ = 0;
    let ì„±ê³µ = Math.random() < (0.61 + 0.001 * ëª¨ë£¨ê°œìˆ˜);
    let ë©”ì‹œì§€ = "ê°•í™” ì‹¤íŒ¨..";

    ìœ ì €.ê³¨ë“œ -= ê°•í™”ë¹„ìš©;

    const ê°•í™”ì¦ê°€ëŸ‰ë§µ = {
        "ì¼ë°˜": 5,
        "ë ˆì–´": 15,
        "ì‹ í™”": 30,
        "ê³ ëŒ€": 80,
        "íƒœì´ˆ": 150,
        "íƒ€ë½": 240,
    };

    const ë‹¨ê³„ê°’ = ê°•í™”ì¦ê°€ëŸ‰ë§µ[ë“±ê¸‰] || 0;

    if (ì„±ê³µ) {
        ì¦ê°€ëŸ‰ = ë‹¨ê³„ê°’;
        ëŒ€ìƒ.ê°•í™” = (ëŒ€ìƒ.ê°•í™” || 0) + 1;
        ë©”ì‹œì§€ = `ê°•í™” ì„±ê³µ! ê³µê²©ë ¥ +${ì¦ê°€ëŸ‰}`;
    } else {
        if ((ëŒ€ìƒ.ê°•í™” || 0) > 0) {
            ì¦ê°€ëŸ‰ = -ë‹¨ê³„ê°’;
            ëŒ€ìƒ.ê°•í™” -= 1;
            ë©”ì‹œì§€ = `ê°•í™” ì‹¤íŒ¨.. ê°•í™” ìˆ˜ì¹˜ê°€ 1 ê°ì†Œí•˜ê³  ê³µê²©ë ¥ ${ì¦ê°€ëŸ‰}`;
        } else {
            ì¦ê°€ëŸ‰ = 0;
            ë©”ì‹œì§€ = "ê°•í™” ì‹¤íŒ¨..";
        }
    }

    ëŒ€ìƒ.ê³µê²©ë ¥ += ì¦ê°€ëŸ‰;
    ìœ ì €.ì¥ë¹„ê³µê²©ë ¥ += ì¦ê°€ëŸ‰;

    const ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥ê³„ì‚°(ìœ ì €);
    ìœ ì €.ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥;

    const { error: ì €ì¥ì˜¤ë¥˜ } = await supabaseAdmin
        .from("users")
        .update({
            ì¥ë¹„ëª©ë¡: ì¥ë¹„ëª©ë¡,
            ì¥ë¹„ê³µê²©ë ¥: ìœ ì €.ì¥ë¹„ê³µê²©ë ¥,
            ìµœì¢…ê³µê²©ë ¥: ìµœì¢…ê³µê²©ë ¥,
            ê³¨ë“œ: ìœ ì €.ê³¨ë“œ
        })
        .eq("ìœ ì €UID", ìœ ì €UID);

    if (ì €ì¥ì˜¤ë¥˜) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }

    return res.json({
        ì„±ê³µ,
        ì¦ê°€ëŸ‰,
        ê°•í™”: ëŒ€ìƒ.ê°•í™”,
        ì¥ë¹„ê³µê²©ë ¥: ìœ ì €.ì¥ë¹„ê³µê²©ë ¥,
        ë¬´ê¸°ê³µê²©ë ¥: ëŒ€ìƒ.ê³µê²©ë ¥, // âœ… ì¶”ê°€!
        ìµœì¢…ê³µê²©ë ¥: ìµœì¢…ê³µê²©ë ¥,
        ê³¨ë“œ: ìœ ì €.ê³¨ë“œ,
        ë©”ì‹œì§€
    });

});

app.post("/update-skill", async (req, res) => {
    const { ìœ ì €UID, ìŠ¤í‚¬ì´ë¦„, í–‰ë™ } = req.body;
    if (!ìœ ì €UID || !ìŠ¤í‚¬ì´ë¦„ || !í–‰ë™) {
        return res.status(400).json({ ì˜¤ë¥˜: "ì…ë ¥ê°’ ëˆ„ë½" });
    }

    const { data: ìœ ì €, error } = await supabaseAdmin
        .from("users")
        .select("ìŠ¤í‚¬, ìˆ™ë ¨ë„, ìœ ë¬¼ëª©ë¡")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    if (error || !ìœ ì €) return res.status(404).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });

    let ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    let ìˆ™ë ¨ë„ = ìœ ì €.ìˆ™ë ¨ë„ || 0;

    if (ìŠ¤í‚¬ì´ë¦„ === "ì „ì²´" && í–‰ë™ === "ì´ˆê¸°í™”") {
        const í”Œë¼ì›Œ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["í”Œë¼ì›Œ"] || 0;

        if (í”Œë¼ì›Œ < 1) {
            return res.status(400).json({ ì˜¤ë¥˜: "í”Œë¼ì›Œ ìœ ë¬¼ì´ ë¶€ì¡±í•©ë‹ˆë‹¤" });
        }

        const ì´íˆ¬ì = Object.values(ìŠ¤í‚¬).reduce((a, b) => a + b, 0);
        const í™˜ê¸‰ = 500 * ì´íˆ¬ì * (ì´íˆ¬ì + 1) / 2;

        ìˆ™ë ¨ë„ += í™˜ê¸‰;
        ìŠ¤í‚¬ = {};

        const ìœ ë¬¼ëª©ë¡ = { ...ìœ ì €.ìœ ë¬¼ëª©ë¡, í”Œë¼ì›Œ: í”Œë¼ì›Œ - 1 }; // 1ê°œ ì°¨ê°

        const { error: ì €ì¥ì˜¤ë¥˜ } = await supabaseAdmin
            .from("users")
            .update({ ìŠ¤í‚¬, ìˆ™ë ¨ë„, ìœ ë¬¼ëª©ë¡ })  // â† ìœ ë¬¼ëª©ë¡ë„ ê°™ì´ ì €ì¥
            .eq("ìœ ì €UID", ìœ ì €UID);

        if (ì €ì¥ì˜¤ë¥˜) return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });

        return res.json({ ì„±ê³µ: true, ìŠ¤í‚¬, ìˆ™ë ¨ë„, ìŠ¤í‚¬ìƒíƒœ: {}, ìœ ë¬¼ëª©ë¡ }); // â† ìœ ë¬¼ëª©ë¡ë„ ê°™ì´ ë°˜í™˜
    }

    const ìŠ¤í‚¬ì •ë³´ = {
        ë²„ì„œì»¤: { ë‹¨ê³„: Array(23).fill(0) },
        ë“œë ˆì¸: { ë‹¨ê³„: Array(23).fill(0) },
        ë°œêµ´: { ë‹¨ê³„: Array(23).fill(0) },
        ì•„ì´ì–¸ë°”ë””: { ë‹¨ê³„: Array(23).fill(0) },
        ì¸ì‚¬ì´íŠ¸: { ë‹¨ê³„: Array(1).fill(0) },
        í¬ë¦¬í‹°ì»¬: { ë‹¨ê³„: Array(23).fill(0) },
        ë²„ë‹: { ë‹¨ê³„: Array(23).fill(0) },
        ì¸í…”ë¦¬ì „ìŠ¤: { ë‹¨ê³„: Array(23).fill(0) },
        ë¸Œë¡œí°: { ë‹¨ê³„: Array(23).fill(0) },
    };

    if (!ìŠ¤í‚¬ì •ë³´[ìŠ¤í‚¬ì´ë¦„]) {
        return res.status(400).json({ ì˜¤ë¥˜: "êµ¬í˜„ì¤‘ì…ë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”" });
    }

    const ë‹¨ê³„ìˆ˜ = ìŠ¤í‚¬ì •ë³´[ìŠ¤í‚¬ì´ë¦„].ë‹¨ê³„.length;
    const ìµœëŒ€ë ˆë²¨ = ë‹¨ê³„ìˆ˜;
    const í˜„ì¬ë ˆë²¨ = ìŠ¤í‚¬[ìŠ¤í‚¬ì´ë¦„] || 0;
    const ì´íˆ¬ì = Object.values(ìŠ¤í‚¬).reduce((a, b) => a + b, 0);

    if (í–‰ë™ === "ìŠµë“") {
        if (í˜„ì¬ë ˆë²¨ >= ìµœëŒ€ë ˆë²¨) return res.status(400).json({ ì˜¤ë¥˜: "ìµœì¢…ë‹¨ê³„ì…ë‹ˆë‹¤" });

        const íˆ¬ì = ì´íˆ¬ì;
        const í•„ìš”í•œìˆ™ë ¨ë„ = (íˆ¬ì + 1) * 500;

        if (ìˆ™ë ¨ë„ < í•„ìš”í•œìˆ™ë ¨ë„) return res.status(400).json({ ì˜¤ë¥˜: "ìˆ™ë ¨ë„ ë¶€ì¡±" });

        ìˆ™ë ¨ë„ -= í•„ìš”í•œìˆ™ë ¨ë„;
        ìŠ¤í‚¬[ìŠ¤í‚¬ì´ë¦„] = í˜„ì¬ë ˆë²¨ + 1;
    }

    else if (í–‰ë™ === "íšŒìˆ˜") {
        if (í˜„ì¬ë ˆë²¨ < 1) return res.status(400).json({ ì˜¤ë¥˜: "íšŒìˆ˜í•  ìŠ¤í‚¬ ì—†ìŒ" });

        const íˆ¬ì = ì´íˆ¬ì;
        const í™˜ê¸‰ìˆ™ë ¨ë„ = íˆ¬ì * 500;

        ìˆ™ë ¨ë„ += í™˜ê¸‰ìˆ™ë ¨ë„;
        ìŠ¤í‚¬[ìŠ¤í‚¬ì´ë¦„] = í˜„ì¬ë ˆë²¨ - 1;
    }

    else {
        return res.status(400).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }

    // âœ… ìŠ¤í‚¬ìƒíƒœ ê³„ì‚°: ê° ê³„ì—´ì˜ í˜„ì¬ ì´ë¦„ê³¼ ì„¤ëª…
    const ìŠ¤í‚¬ìƒíƒœ = {};
    for (const í‚¤ in ìŠ¤í‚¬ì •ë³´) {
        const ë ˆë²¨ = ìŠ¤í‚¬[í‚¤] || 0;
        const ì¸ë±ìŠ¤ = Math.min(ë ˆë²¨ - 1, ìŠ¤í‚¬ì •ë³´[í‚¤].ë‹¨ê³„.length - 1);
        if (ë ˆë²¨ > 0) {
            ìŠ¤í‚¬ìƒíƒœ[í‚¤] = {
                ì´ë¦„: ìŠ¤í‚¬ì •ë³´[í‚¤].ë‹¨ê³„[ì¸ë±ìŠ¤]
            };
        } else {
            ìŠ¤í‚¬ìƒíƒœ[í‚¤] = {
                ì´ë¦„: ìŠ¤í‚¬ì •ë³´[í‚¤].ë‹¨ê³„[0]
            };
        }
    }

    const { error: ì €ì¥ì˜¤ë¥˜ } = await supabaseAdmin
        .from("users")
        .update({ ìŠ¤í‚¬, ìˆ™ë ¨ë„ })
        .eq("ìœ ì €UID", ìœ ì €UID);

    if (ì €ì¥ì˜¤ë¥˜) return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });

    return res.json({ ì„±ê³µ: true, ìŠ¤í‚¬, ìˆ™ë ¨ë„, ìŠ¤í‚¬ìƒíƒœ });
});



app.post("/register-user", async (req, res) => {
    const { ìœ ì €UID, ìœ ì €ì•„ì´ë””, ê¸°ê¸°ID, ë¡œê·¸ì¸ì´ë©”ì¼ } = req.body;

    if (!ìœ ì €UID || !ìœ ì €ì•„ì´ë”” || !ê¸°ê¸°ID) {
        return res.status(400).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }

    const now = new Date();
    const formatter = new Intl.DateTimeFormat("ko-KR", {
        hour: "numeric",
        hour12: false,
        timeZone: "Asia/Seoul"
    });
    const parts = formatter.formatToParts(now);
    const í˜„ì¬ì‹œê°„ = Number(parts.find(p => p.type === "hour")?.value);

    // âœ… ë§ˆë²•ì˜íŒ”ë ˆíŠ¸ ìë™ ì§€ì • ë¡œì§ ì¶”ê°€
    const ì´ë©”ì¼íŒ”ë ˆíŠ¸ë§µ = {
        "rkrmfrkt@gagl.com": "ê°€ê¸€",
        "johny87@gagl.com": "ë„¤ì˜¨ì‚¬ì¸",
        "pink@gagl.com": "í•‘í¬ì˜¤ì…˜",
        "1234qwer@gagl.com": "í™©í˜¼í•˜ëŠ˜",
        "saiha@gagl.com": "ì—ë©”ë„ë“œìˆ²",
        "009900@gagl.com": "ê²¨ìš¸",
        "naataa@gagl.com": "ë¯¼ì´ˆ",
        "sibasrigal1@gagl.com": "ë¸”ë¼ì„¬",
        "wlstjr1q2w@gagl.com": "ì§€ì˜¥",
    };
    const ë§ˆë²•ì˜íŒ”ë ˆíŠ¸ = ì´ë©”ì¼íŒ”ë ˆíŠ¸ë§µ[ë¡œê·¸ì¸ì´ë©”ì¼] || null;

    //ì‹ ê·œìœ ì €
    const ì‚½ì…ê°’ = {
        ìœ ì €UID,
        ìœ ì €ì•„ì´ë””,
        ë¡œê·¸ì¸ì´ë©”ì¼,
        ê¸°ê¸°ID,
        ë ˆë²¨: 1,
        ë ˆë²¨ê³µê²©ë ¥: 10,
        ì „ì§ê³µê²©ë ¥: 1,
        ìµœì¢…ê³µê²©ë ¥: 10,
        ì¥ë¹„ê³µê²©ë ¥: 0,
        í«ë‹¨ê³„: 0,
        ê²½í—˜ì¹˜: 0,
        ê³¨ë“œ: 0,
        ìµœëŒ€ì²´ë ¥: 10,
        ë‚¨ì€ì²´ë ¥: 10,
        ìˆ™ë ¨ë„: 0,
        í˜„ì¬ì¸µ: 1,
        í˜„ì¬ì•…ë§ˆë²ˆí˜¸: Math.floor(Math.random() * 72) + 1,
        ìŠ¤í‚¬: {},
        ì¡°ìš°ê¸°ë¡: { ì¼ë°˜: 0, ë ˆì–´: 0, ì‹ í™”: 0, ê³ ëŒ€: 0, íƒœì´ˆ: 0, íƒ€ë½: 0 },
        í•©ì„±ê¸°ë¡: {},
        ìœ ë¬¼ëª©ë¡: { "ìƒëŸ¬ë“œ": 5 },
        ì¥ë¹„ëª©ë¡: [],
        ë²„ì „ì—…: 7,
        í˜„ì¬ìŠ¤íƒœë¯¸ë„ˆ: 1000,
        ìµœëŒ€ìŠ¤íƒœë¯¸ë„ˆ: 1000,
        ìŠ¤íƒœë¯¸ë„ˆê°±ì‹ ì‹œê°„: í˜„ì¬ì‹œê°„,
        ì „ì§ì •ë³´: {
            "ë°±ì¸ì¥": 0,
            "ì˜¤ë°±ì¸ì¥": 0,
            "ì²œì¸ì¥": 0,
            "ë§Œì¸ì¥": 0,
            "ë¶€ì¥êµ°": 0,
            "ì¥êµ°": 0,
            "ëŒ€ì¥êµ°": 0,
            "ëŒ€ì‚¬ë§ˆ": 0,
            "ìŠ¹ìƒ": 0,
            "í›„": 0,
            "ê³µ": 0,
            "ì œí›„": 0,
            "ì™•": 0,
            "í™©ì œ": 0,
            "ì²œí™©": 0,
            "ì œí™©": 0,
            "íƒœí™©": 0,
            "ì²œì œ": 0
        },
        ë§ˆë²•ì˜íŒ”ë ˆíŠ¸,
    };

    const { error: ì‚½ì…ì˜¤ë¥˜ } = await supabaseAdmin
        .from("users")
        .insert(ì‚½ì…ê°’);

    if (ì‚½ì…ì˜¤ë¥˜) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }

    return res.json({ ìœ ì €ë°ì´í„°: ì‚½ì…ê°’ });
});

app.post("/ranking", async (req, res) => {
    const { ìœ ì €UID } = req.body;

    try {
        const { data: ìœ ì €ë“¤, error } = await supabaseAdmin
            .from("users")
            .select("ìœ ì €UID, ë¡œê·¸ì¸ì´ë©”ì¼, ìœ ì €ì•„ì´ë””, ë ˆë²¨, ìµœì¢…ê³µê²©ë ¥, í˜„ì¬ì¸µ, ì¥ë¹„ëª©ë¡, í•©ì„±ê¸°ë¡, ì „ì§ì •ë³´, ë§ˆë²•ì˜íŒ”ë ˆíŠ¸")
            .eq("ë²„ì „ì—…", 7)
            .not("ìµœì¢…ê³µê²©ë ¥", "is", null)
            .neq("ìœ ì €ì•„ì´ë””", "í…ŒìŠ¤íŠ¸ì•„ì´ë””")
            .order("ìµœì¢…ê³µê²©ë ¥", { ascending: false })

        if (error) {
            return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
        }

        for (const ìœ ì € of ìœ ì €ë“¤) {
            ìœ ì €.ì§ìœ„ = ìµœê³ ì „ì§ëª…(ìœ ì €.ì „ì§ì •ë³´) || "";
        }

        return res.json({ ìœ ì €ë“¤ });
    } catch (e) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }
});

app.post("/delete-user", async (req, res) => {
    const { ìœ ì €UID } = req.body;

    if (!ìœ ì €UID) {
        return res.status(400).json({ ì˜¤ë¥˜: "UID ëˆ„ë½ë¨" });
    }

    try {
        // 1. users í…Œì´ë¸” ì‚­ì œ
        const { error: í…Œì´ë¸”ì‚­ì œì˜¤ë¥˜ } = await supabaseAdmin
            .from("users")
            .delete()
            .eq("ìœ ì €UID", ìœ ì €UID);

        if (í…Œì´ë¸”ì‚­ì œì˜¤ë¥˜) {
            console.error("ìœ ì € í…Œì´ë¸” ì‚­ì œ ì‹¤íŒ¨:", í…Œì´ë¸”ì‚­ì œì˜¤ë¥˜.message);
            return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
        }

        // 2. Supabase Auth ê³„ì • ì‚­ì œ
        const { error: ì¸ì¦ì‚­ì œì˜¤ë¥˜ } = await supabaseAdmin.auth.admin.deleteUser(ìœ ì €UID);

        if (ì¸ì¦ì‚­ì œì˜¤ë¥˜) {
            console.error("Auth ì‚­ì œ ì‹¤íŒ¨:", ì¸ì¦ì‚­ì œì˜¤ë¥˜.message);
            return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
        }

        return res.json({ ë©”ì‹œì§€: "ìœ ì € ë°ì´í„° ë° ì¸ì¦ ì‚­ì œ ì™„ë£Œ" });
    } catch (e) {
        console.error("ìœ ì € ì‚­ì œ ì¤‘ ì˜ˆì™¸:", e.message);
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }
});

app.post("/update-username", async (req, res) => {
    const { ìœ ì €UID, ìƒˆì•„ì´ë”” } = req.body;

    if (!ìœ ì €UID || !ìƒˆì•„ì´ë”” || ìƒˆì•„ì´ë””.length > 8) {
        return res.status(400).json({ ì˜¤ë¥˜: "ì…ë ¥ê°’ ëˆ„ë½ ë˜ëŠ” ê¸¸ì´ ì´ˆê³¼" });
    }

    // âœ… ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë”” ìˆëŠ”ì§€ í™•ì¸
    const { data: ì¤‘ë³µ, error: ì¡°íšŒì˜¤ë¥˜ } = await supabaseAdmin
        .from("users")
        .select("ìœ ì €UID")
        .eq("ìœ ì €ì•„ì´ë””", ìƒˆì•„ì´ë””)
        .neq("ìœ ì €UID", ìœ ì €UID);

    if (ì¡°íšŒì˜¤ë¥˜) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }

    if (ì¤‘ë³µ.length > 0) {
        return res.status(409).json({ ì˜¤ë¥˜: "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤" });
    }

    const { error: ì—…ë°ì´íŠ¸ì˜¤ë¥˜ } = await supabaseAdmin
        .from("users")
        .update({ ìœ ì €ì•„ì´ë””: ìƒˆì•„ì´ë”” })
        .eq("ìœ ì €UID", ìœ ì €UID);

    if (ì—…ë°ì´íŠ¸ì˜¤ë¥˜) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }

    return res.json({ ì„±ê³µ: true });
});

app.post("/get-job-info", async (req, res) => {
    const { ìœ ì €UID } = req.body;

    if (!ìœ ì €UID) return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì €UID ëˆ„ë½" });

    const { data: ìœ ì €, error } = await supabaseAdmin
        .from("users")
        .select("ì „ì§ì •ë³´, ê²½í—˜ì¹˜")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    if (error || !ìœ ì €) return res.status(404).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });

    return res.json({
        ì „ì§ì •ë³´: ìœ ì €.ì „ì§ì •ë³´,
        ê²½í—˜ì¹˜: ìœ ì €.ê²½í—˜ì¹˜
    });
});

app.post("/promote-job", async (req, res) => {
    const { ìœ ì €UID, ì§ìœ„ } = req.body;

    if (!ìœ ì €UID || !ì§ìœ„) {
        return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì €UID ë˜ëŠ” ì§ìœ„ ëˆ„ë½" });
    }

    // ìœ ì € ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    const { data: ìœ ì €, error } = await supabaseAdmin
        .from("users")
        .select("*")
        .eq("ìœ ì €UID", ìœ ì €UID)
        .single();

    const ì „ì§ì •ë³´ = ìœ ì €.ì „ì§ì •ë³´ ?? {};
    const ì™„ë£Œì „ì§ê°¯ìˆ˜ = Object.values(ì „ì§ì •ë³´).filter(v => v === 1).length;
    const ë¹„ìš© = (ì™„ë£Œì „ì§ê°¯ìˆ˜ + 1) * 50000;

    if (error || !ìœ ì €) {
        return res.status(404).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });
    }

    const ê²½í—˜ì¹˜ = ìœ ì €.ê²½í—˜ì¹˜ ?? 0;

    if (ê²½í—˜ì¹˜ < ë¹„ìš©) {
        return res.status(400).json({ ì˜¤ë¥˜: "ê²½í—˜ì¹˜ ë¶€ì¡±" });
    }

    if (ì „ì§ì •ë³´[ì§ìœ„] === 1) {
        return res.status(400).json({ ì˜¤ë¥˜: "ì´ë¯¸ ì „ì§ ì™„ë£Œëœ ì§ìœ„ì…ë‹ˆë‹¤" });
    }

    ì „ì§ì •ë³´[ì§ìœ„] = 1;

    ìœ ì €.ì „ì§ê³µê²©ë ¥ = ì™„ë£Œì „ì§ê°¯ìˆ˜ + 2;
    const ìƒˆë ˆë²¨ = Math.floor((ê²½í—˜ì¹˜ - ë¹„ìš©) / 1000) + 1;

    const ìƒˆë ˆë²¨ê³µê²©ë ¥ = 10 + (ìƒˆë ˆë²¨ - 1) * 5;
    ìœ ì €.ë ˆë²¨ê³µê²©ë ¥ = ìƒˆë ˆë²¨ê³µê²©ë ¥;

    const ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥ê³„ì‚°(ìœ ì €);
    ìœ ì €.ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥;

    const ì—…ë°ì´íŠ¸ = {
        ë ˆë²¨ê³µê²©ë ¥: ìƒˆë ˆë²¨ê³µê²©ë ¥,
        ìµœì¢…ê³µê²©ë ¥: ìµœì¢…ê³µê²©ë ¥,
        ê²½í—˜ì¹˜: ê²½í—˜ì¹˜ - ë¹„ìš©,
        ë ˆë²¨: ìƒˆë ˆë²¨,
        ì „ì§ì •ë³´,
        ì „ì§ê³µê²©ë ¥: ì™„ë£Œì „ì§ê°¯ìˆ˜ + 2  // âœ… ì¶”ê°€ë¨
    };

    const { error: ì—…ë°ì´íŠ¸ì˜¤ë¥˜ } = await supabaseAdmin
        .from("users")
        .update(ì—…ë°ì´íŠ¸)
        .eq("ìœ ì €UID", ìœ ì €UID);

    if (ì—…ë°ì´íŠ¸ì˜¤ë¥˜) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }

    return res.json({ ì„±ê³µ: true, ì „ì§ì •ë³´: ì „ì§ì •ë³´, ê²½í—˜ì¹˜: ê²½í—˜ì¹˜ - ë¹„ìš©, ë ˆë²¨: ìƒˆë ˆë²¨, ìµœì¢…ê³µê²©ë ¥: ìµœì¢…ê³µê²©ë ¥ });
});

function ìµœê³ ì „ì§ëª…(ì „ì§ì •ë³´) {
    const ì „ì§ìˆœì„œ = ["ë°±ì¸ì¥", "ì˜¤ë°±ì¸ì¥", "ì²œì¸ì¥", "ë§Œì¸ì¥", "ë¶€ì¥êµ°", "ì¥êµ°", "ëŒ€ì¥êµ°", "ëŒ€ì‚¬ë§ˆ", "ìŠ¹ìƒ", "í›„", "ê³µ", "ì œí›„", "ì™•", "í™©ì œ", "ì²œí™©", "ì œí™©", "íƒœí™©", "ì²œì œ"];

    let ë§ˆì§€ë§‰ì§ìœ„ = null;
    for (const ì§ìœ„ of ì „ì§ìˆœì„œ) {
        if (ì „ì§ì •ë³´?.[ì§ìœ„] === 1) {
            ë§ˆì§€ë§‰ì§ìœ„ = ì§ìœ„;
        } else {
            break;
        }
    }
    return ë§ˆì§€ë§‰ì§ìœ„;
}

app.post("/gamble-Equipment", async (req, res) => {
    const { ìœ ì €UID, ì¢…ë¥˜ } = req.body;
    const ë¹„ìš© = 100000;

    try {
        const { data: ìœ ì €, error } = await supabaseAdmin
            .from("users")
            .select("*")
            .eq("ìœ ì €UID", ìœ ì €UID)
            .single();

        if (error || !ìœ ì €) return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });


        if (ì¢…ë¥˜ === "ê³ ê¸‰") {
            const í‹°ì¼“ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["í‹°ì¼“"] || 0;
            if (í‹°ì¼“ < 1) {
                return res.status(400).json({ ì˜¤ë¥˜: "í‹°ì¼“ì´ ë¶€ì¡±í•©ë‹ˆë‹¤" });
            }
            ìœ ì €.ìœ ë¬¼ëª©ë¡["í‹°ì¼“"] = í‹°ì¼“ - 1;
        }

        const ì¥ë¹„ë§µ = {
            "ì¼ë°˜": { ì´ë¦„: "ë¦´ë¦¬íŠ¸ì˜ ë…ë‹ˆ", ê³µê²©ë ¥: 30 },
            "ë ˆì–´": { ì´ë¦„: "ë””ì•„ë¸”ë¡œì˜ ë¿”", ê³µê²©ë ¥: 63 },
            "ì‹ í™”": { ì´ë¦„: "ë ˆë¹„ì•„íƒ„ì˜ ë¹„ëŠ˜", ê³µê²©ë ¥: 132 },
            "ê³ ëŒ€": { ì´ë¦„: "ë²¨ì œë¶€ë¸Œì˜ ê¼¬ë¦¬", ê³µê²©ë ¥: 276 },
            "íƒœì´ˆ": { ì´ë¦„: "ì‚¬íƒ„ì˜ ë‚ ê°œ", ê³µê²©ë ¥: 576 },
            "íƒ€ë½": { ì´ë¦„: "ë£¨ì‹œí¼ì˜ ì‹¬ì¥", ê³µê²©ë ¥: 1200 }
        };

        // ìœ ì € ì¡°íšŒ í›„ ì¶”ê°€
        const í´ë¡œë²„ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["í´ë¡œë²„"] || 0;
        const ë³´ì • = 1 + 0.001 * í´ë¡œë²„;

        let í™•ë¥ í‘œ;

        if (ì¢…ë¥˜ === "ê³ ê¸‰") {
            í™•ë¥ í‘œ = [
                { ë“±ê¸‰: "íƒ€ë½", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 25600, 500)) },
                { ë“±ê¸‰: "íƒœì´ˆ", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 12800, 500)) },
                { ë“±ê¸‰: "ê³ ëŒ€", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 6400, 500)) },
                { ë“±ê¸‰: "ì‹ í™”", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 3200, 500)) },
                { ë“±ê¸‰: "ë ˆì–´", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 1600, 500)) }
            ];
        } else {
            í™•ë¥ í‘œ = [
                { ë“±ê¸‰: "íƒœì´ˆ", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 12800, 500)) },
                { ë“±ê¸‰: "ê³ ëŒ€", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 6400, 500)) },
                { ë“±ê¸‰: "ì‹ í™”", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 3200, 500)) },
                { ë“±ê¸‰: "ë ˆì–´", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 1600, 500)) },
                { ë“±ê¸‰: "ì¼ë°˜", í™•ë¥ : ë³´ì • * (1 - Math.pow(1 - 1 / 800, 500)) }
            ];
        }

        const í¼ì¦ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["í¼ì¦"] || 0;
        const í¼ì¦ë°œë™ = Math.random() < 0.001 * í¼ì¦;

        if (ì¢…ë¥˜ !== "ê³ ê¸‰" && !í¼ì¦ë°œë™ && ìœ ì €.ê³¨ë“œ < ë¹„ìš©) {
            return res.status(400).json({ ì˜¤ë¥˜: "ê³¨ë“œ ë¶€ì¡±" });
        }

        if (ì¢…ë¥˜ !== "ê³ ê¸‰" && !í¼ì¦ë°œë™) {
            ìœ ì €.ê³¨ë“œ -= ë¹„ìš©;
        }

        const ë‚¨ì€ê³¨ë“œ = ìœ ì €.ê³¨ë“œ;


        let r = Math.random();
        let ëˆ„ì  = 0;
        let ë½‘íŒë“±ê¸‰ = í™•ë¥ í‘œ[í™•ë¥ í‘œ.length - 1].ë“±ê¸‰;

        for (const í•­ëª© of í™•ë¥ í‘œ) {
            ëˆ„ì  += í•­ëª©.í™•ë¥ ;
            if (r < ëˆ„ì ) {
                ë½‘íŒë“±ê¸‰ = í•­ëª©.ë“±ê¸‰;
                break;
            }
        }


        const ë“œëì¥ë¹„ = ì¥ë¹„ë§µ[ë½‘íŒë“±ê¸‰];

        const ì¥ë¹„ëª©ë¡ = ìœ ì €.ì¥ë¹„ëª©ë¡ || [];
        const ê¸°ë¡ = ìœ ì €.í•©ì„±ê¸°ë¡ || {};
        const í‚¤ = `${ë“œëì¥ë¹„.ì´ë¦„}|${ë½‘íŒë“±ê¸‰}`;
        let ê¸°ì¡´ = ì¥ë¹„ëª©ë¡.find(j => j.ì´ë¦„ === ë“œëì¥ë¹„.ì´ë¦„ && j.ë“±ê¸‰ === ë½‘íŒë“±ê¸‰);
        let ì²´ë ¥ì¦ê°€ëŸ‰ = 0;
        let ê³µê²©ë ¥ì¦ê°€ëŸ‰ = ë“œëì¥ë¹„.ê³µê²©ë ¥;

        if (ê¸°ì¡´) {
            ê¸°ì¡´.ê³µê²©ë ¥ += ë“œëì¥ë¹„.ê³µê²©ë ¥;
            ê¸°ë¡[í‚¤] = (ê¸°ë¡[í‚¤] || 0) + 1;
            if (ë½‘íŒë“±ê¸‰ === "íƒœì´ˆ" || ë½‘íŒë“±ê¸‰ === "íƒ€ë½") {
                ì²´ë ¥ì¦ê°€ëŸ‰ = 1;
            }
        } else {
            ì¥ë¹„ëª©ë¡.push({ ì´ë¦„: ë“œëì¥ë¹„.ì´ë¦„, ë“±ê¸‰: ë½‘íŒë“±ê¸‰, ê³µê²©ë ¥: ë“œëì¥ë¹„.ê³µê²©ë ¥, ê°•í™”: 0 });
            ê¸°ë¡[í‚¤] = 0;
        }

        ìœ ì €.ì¥ë¹„ê³µê²©ë ¥ += ê³µê²©ë ¥ì¦ê°€ëŸ‰;
        ìœ ì €.ìµœì¢…ê³µê²©ë ¥ = ìµœì¢…ê³µê²©ë ¥ê³„ì‚°(ìœ ì €);

        const ì—…ë°ì´íŠ¸ = {
            ê³¨ë“œ: ë‚¨ì€ê³¨ë“œ,
            ì¥ë¹„ëª©ë¡,
            í•©ì„±ê¸°ë¡: ê¸°ë¡,
            ìµœëŒ€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥ + ì²´ë ¥ì¦ê°€ëŸ‰,
            ì¥ë¹„ê³µê²©ë ¥: ìœ ì €.ì¥ë¹„ê³µê²©ë ¥,
            ìµœì¢…ê³µê²©ë ¥: ìœ ì €.ìµœì¢…ê³µê²©ë ¥,
            ...(ì¢…ë¥˜ === "ê³ ê¸‰" ? { ìœ ë¬¼ëª©ë¡: ìœ ì €.ìœ ë¬¼ëª©ë¡ } : {}),
        };

        await supabaseAdmin
            .from("users")
            .update(ì—…ë°ì´íŠ¸)
            .eq("ìœ ì €UID", ìœ ì €UID);

        const ìœ ì €ë°ì´í„° = { ...ìœ ì €, ...ì—…ë°ì´íŠ¸ };

        return res.json({
            ìœ ì €ë°ì´í„°,
            ì¥ë¹„: { ...ë“œëì¥ë¹„, ë“±ê¸‰: ë½‘íŒë“±ê¸‰ },
            ê²°ê³¼: "ì„±ê³µ",
            í¼ì¦ë°œë™
        });

    } catch (e) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }
});

app.post("/gamble-Relic", async (req, res) => {
    const { ìœ ì €UID } = req.body;
    const ë¹„ìš© = 100000;

    try {
        const { data: ìœ ì €, error } = await supabaseAdmin
            .from("users")
            .select("*")
            .eq("ìœ ì €UID", ìœ ì €UID)
            .single();

        if (error || !ìœ ì €) {
            return res.status(400).json({ ì˜¤ë¥˜: "ìœ ì € ì •ë³´ ì—†ìŒ" });
        }

        const í›„ë³´ = Object.keys(ë ˆì–´ìœ ë¬¼ë°ì´í„°).filter(ì´ë¦„ => {
            const ë³´ìœ  = ìœ ì €.ìœ ë¬¼ëª©ë¡?.[ì´ë¦„] || 0;
            return ë³´ìœ  < 99;
        });

        // â›”ï¸ ë¨¼ì € í›„ë³´ ìœ ë¬¼ì´ ìˆëŠ”ì§€ í™•ì¸
        if (í›„ë³´.length === 0) {
            return res.status(400).json({ ì˜¤ë¥˜: "ë” ì´ìƒ íšë“ ê°€ëŠ¥í•œ ìœ ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤" });
        }

        const í¼ì¦ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["í¼ì¦"] || 0;
        const í¼ì¦ë°œë™ = Math.random() < 0.001 * í¼ì¦;

        // â›”ï¸ í¼ì¦ì´ ì—†ê³ , ê³¨ë“œë„ ë¶€ì¡±í•˜ë©´ ì¤‘ë‹¨
        if (!í¼ì¦ë°œë™ && ìœ ì €.ê³¨ë“œ < ë¹„ìš©) {
            return res.status(400).json({ ì˜¤ë¥˜: "ê³¨ë“œ ë¶€ì¡±" });
        }

        // âœ… ì´ì œ ì•ˆì „í•˜ê²Œ ì°¨ê°
        if (!í¼ì¦ë°œë™) {
            ìœ ì €.ê³¨ë“œ -= ë¹„ìš©;
        }

        const ìœ ë¬¼ì´ë¦„ = í›„ë³´[Math.floor(Math.random() * í›„ë³´.length)];
        const ìœ ë¬¼ëª©ë¡ = { ...ìœ ì €.ìœ ë¬¼ëª©ë¡ };
        ìœ ë¬¼ëª©ë¡[ìœ ë¬¼ì´ë¦„] = (ìœ ë¬¼ëª©ë¡[ìœ ë¬¼ì´ë¦„] || 0) + 1;

        const ì—…ë°ì´íŠ¸ = {
            ê³¨ë“œ: ìœ ì €.ê³¨ë“œ,
            ìœ ë¬¼ëª©ë¡
        };

        await supabaseAdmin
            .from("users")
            .update(ì—…ë°ì´íŠ¸)
            .eq("ìœ ì €UID", ìœ ì €UID);

        const ìœ ì €ë°ì´í„° = { ...ìœ ì €, ...ì—…ë°ì´íŠ¸ };

        return res.json({
            ê²°ê³¼: "ì„±ê³µ",
            ìœ ì €ë°ì´í„°,
            ìœ ë¬¼ì´ë¦„,
            í¼ì¦ë°œë™
        });
    } catch (e) {
        return res.status(500).json({ ì˜¤ë¥˜: "ì œì˜ëª»ì•„ë‹ˆê³  ì„œë²„ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”" });
    }
});

app.listen(3000, () => {
});

function í¬ë¦¬í‹°ì»¬ë°°ìœ¨ê³„ì‚°(ìœ ì €) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ë ˆë²¨ = ìŠ¤í‚¬["í¬ë¦¬í‹°ì»¬"] || 0;
    if (ë ˆë²¨ <= 0) return 1; // ë°°ìš´ ê²Œ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ 1ë°°

    // ê° ë ˆë²¨ë‹¹ 10% â†’ 0.1 ì¦ê°€, ê¸°ë³¸ ë°°ìœ¨ 1
    return 1 + ë ˆë²¨ * 0.1;
}

function ë²„ì„œì»¤ë°°ìœ¨ê³„ì‚°(ìœ ì €) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ë ˆë²¨ = ìŠ¤í‚¬["ë²„ì„œì»¤"] || 0;

    return {
        ë°°ìœ¨: ë ˆë²¨ > 0 ? 1.1 * ë ˆë²¨ + 1.1 : 1, // ê¸°ë³¸ 1ë°°
        ì²´ë ¥ì†Œëª¨: ë ˆë²¨
    };
}

function ë²„ë‹ë°°ìœ¨ê³„ì‚°(ìœ ì €, í˜„ì¬HP, ìµœëŒ€HP) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ë ˆë²¨ = ìŠ¤í‚¬["ë²„ë‹"] || 0;

    // ì²´ë ¥ì´ 50% ì´ìƒì´ë©´ ë°œë™ ì•ˆ í•¨
    if (í˜„ì¬HP > ìµœëŒ€HP * 0.5) return 1;

    return ë ˆë²¨ > 0 ? 1 + ë ˆë²¨ * 0.2 : 1;
}

function ë¸Œë¡œí°ë°©ì–´ë¬´ì‹œìœ¨ê³„ì‚°(ìœ ì €) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ë ˆë²¨ = ìŠ¤í‚¬["ë¸Œë¡œí°"] || 0;
    return ë ˆë²¨ * 0.04;
}

function ë°ë¯¸ì§€ê³„ì‚°(ìœ ì €, ëª¬ìŠ¤í„°, ìŠ¤í‚¬ê²°ê³¼) {
    let ë°©ì–´ë ¥ = ëª¬ìŠ¤í„°.ë°©ì–´ë ¥ || 0;

    const ì‰´ë“œë°´ê°œìˆ˜ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ì‰´ë“œë°´"] || 0;
    const ë³´ì • = 1 - 0.01 * ì‰´ë“œë°´ê°œìˆ˜;

    if (ìŠ¤í‚¬ê²°ê³¼.ë°©ì–´ë¬´ì‹œìœ¨ > 0) {
        ë°©ì–´ë ¥ = Math.floor(ë°©ì–´ë ¥ * (1 - ìŠ¤í‚¬ê²°ê³¼.ë°©ì–´ë¬´ì‹œìœ¨) * ë³´ì •);
    }

    const ëœë¤ë³´ì • = Math.random() * 0.4 + 0.8;

    const ê¸°ë³¸ë°ë¯¸ì§€ = Math.max(0, ìœ ì €.ìµœì¢…ê³µê²©ë ¥ - ë°©ì–´ë ¥);
    const ëœë¤ë°ë¯¸ì§€ = Math.floor(ê¸°ë³¸ë°ë¯¸ì§€ * ëœë¤ë³´ì •);

    const ìµœì¢…ë°°ìœ¨ = (ìŠ¤í‚¬ê²°ê³¼.í¬ë¦¬í‹°ì»¬ë°°ìœ¨) * (ìŠ¤í‚¬ê²°ê³¼.ë²„ì„œì»¤ë°°ìœ¨) * (ìŠ¤í‚¬ê²°ê³¼.ë²„ë‹ë°°ìœ¨);
    const ìµœì¢…ë°ë¯¸ì§€ = Math.floor(ëœë¤ë°ë¯¸ì§€ * ìµœì¢…ë°°ìœ¨);

    return ìµœì¢…ë°ë¯¸ì§€;
}

function ì „íˆ¬ì‹œë®¬ë ˆì´ì…˜(ìœ ì €, ëª¬ìŠ¤í„°, ì „íˆ¬ë¡œê·¸, ì‹œì‘í„´, ë³´ìŠ¤ì „ = false) {
    let ìœ ì €HP = ìœ ì €.ë‚¨ì€ì²´ë ¥;

    const í•˜íŠ¸ë§ˆì´ë„ˆìŠ¤ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["í•˜íŠ¸ë§ˆì´ë„ˆìŠ¤"] || 0;
    const ë³´ì • = 1 - 0.001 * í•˜íŠ¸ë§ˆì´ë„ˆìŠ¤;
    ëª¬ìŠ¤í„°.ì²´ë ¥ = Math.floor(ëª¬ìŠ¤í„°.ì²´ë ¥ * ë³´ì •);
    let ëª¬ìŠ¤í„°HP = ëª¬ìŠ¤í„°.ì²´ë ¥;
    let í˜„ì¬í„´ = ì‹œì‘í„´;

    while (ìœ ì €HP > 0 && (ë³´ìŠ¤ì „ || ëª¬ìŠ¤í„°HP > 0)) {
        ëª¬ìŠ¤í„°HP = Math.max(0, ëª¬ìŠ¤í„°HP);
        ìœ ì €HP = Math.max(0, ìœ ì €HP);

        ìœ ì €HP--;

        // ğŸŸ¡ ìŠ¤í‚¬ë³„ ê°œë³„ ê³„ì‚°
        const í¬ë¦¬í‹°ì»¬ë°°ìœ¨ = í¬ë¦¬í‹°ì»¬ë°°ìœ¨ê³„ì‚°(ìœ ì €);
        const { ë°°ìœ¨: ë²„ì„œì»¤ë°°ìœ¨, ì²´ë ¥ì†Œëª¨ } = ë²„ì„œì»¤ë°°ìœ¨ê³„ì‚°(ìœ ì €);
        const ë²„ë‹ë°°ìœ¨ = ë²„ë‹ë°°ìœ¨ê³„ì‚°(ìœ ì €, ìœ ì €HP, ìœ ì €.ìµœëŒ€ì²´ë ¥);
        const ë°©ì–´ë¬´ì‹œìœ¨ = ë¸Œë¡œí°ë°©ì–´ë¬´ì‹œìœ¨ê³„ì‚°(ìœ ì €);

        const ë°ë¯¸ì§€ = ë°ë¯¸ì§€ê³„ì‚°(ìœ ì €, ëª¬ìŠ¤í„°, {
            í¬ë¦¬í‹°ì»¬ë°°ìœ¨,
            ë²„ì„œì»¤ë°°ìœ¨,
            ë²„ë‹ë°°ìœ¨,
            ë°©ì–´ë¬´ì‹œìœ¨
        });

        ìœ ì €HP -= ì²´ë ¥ì†Œëª¨;

        if (!ë³´ìŠ¤ì „) {
            ëª¬ìŠ¤í„°HP -= ë°ë¯¸ì§€;
            ëª¬ìŠ¤í„°HP = Math.max(0, ëª¬ìŠ¤í„°HP);
        }

        const ë°œë™ì•„ì´ì½˜ = [];
        if (í¬ë¦¬í‹°ì»¬ë°°ìœ¨ > 1) ë°œë™ì•„ì´ì½˜.push("í¬ë¦¬í‹°ì»¬ì•„ì´ì½˜");
        if (ë²„ì„œì»¤ë°°ìœ¨ > 1) ë°œë™ì•„ì´ì½˜.push("ë²„ì„œì»¤ì•„ì´ì½˜");
        if (ë²„ë‹ë°°ìœ¨ > 1) ë°œë™ì•„ì´ì½˜.push("ë²„ë‹ì•„ì´ì½˜");
        if (ë°©ì–´ë¬´ì‹œìœ¨ > 0) ë°œë™ì•„ì´ì½˜.push("ë¸Œë¡œí°ì•„ì´ì½˜");

        const ì‰´ë“œë°´ê°œìˆ˜ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ì‰´ë“œë°´"] || 0;
        const ë°©ì–´ë³´ì • = 1 - 0.01 * ì‰´ë“œë°´ê°œìˆ˜;

        const ëª¬ìŠ¤í„°ë°©ì–´ë ¥ê³„ì‚° = Math.floor(
            (ëª¬ìŠ¤í„°.ë°©ì–´ë ¥ || 0) *
            (1 - ë°©ì–´ë¬´ì‹œìœ¨) *
            ë°©ì–´ë³´ì •
        );

        ì „íˆ¬ë¡œê·¸.push({
            í„´: í˜„ì¬í„´,
            íƒ€ì…: "ê³µê²©",
            ìœ ì €ì•„ì´ë””: ìœ ì €.ìœ ì €ì•„ì´ë””,
            ìœ ì €ê³µê²©ë ¥: ìœ ì €.ê³µê²©ë ¥,
            ìœ ì €ìµœì¢…ê³µê²©ë ¥: ìœ ì €.ìµœì¢…ê³µê²©ë ¥,
            ìœ ì €ì²´ë ¥: ìœ ì €HP,
            ìœ ì €ìµœëŒ€ì²´ë ¥: ìœ ì €.ìµœëŒ€ì²´ë ¥,
            ëª¬ìŠ¤í„°ì´ë¦„: ëª¬ìŠ¤í„°.ì´ë¦„,
            ëª¬ìŠ¤í„°ì²´ë ¥: ë³´ìŠ¤ì „ ? ëª¬ìŠ¤í„°.ì²´ë ¥ : ëª¬ìŠ¤í„°HP,
            ëª¬ìŠ¤í„°ìµœëŒ€ì²´ë ¥: ëª¬ìŠ¤í„°.ì²´ë ¥,
            ëª¬ìŠ¤í„°ë°©ì–´ë ¥: ëª¬ìŠ¤í„°ë°©ì–´ë ¥ê³„ì‚°,
            ì•„ì´ì½˜: ë°œë™ì•„ì´ì½˜,
            íš¨ê³¼: `${ë°ë¯¸ì§€}`
        });

        í˜„ì¬í„´++;
    }

    return {
        ê²°ê³¼: ìœ ì €HP <= 0 ? "íŒ¨ë°°" : "ìŠ¹ë¦¬",
        ìœ ì €ë‚¨ì€ì²´ë ¥: ìœ ì €HP,
        ëª¬ìŠ¤í„°ë‚¨ì€ì²´ë ¥: ëª¬ìŠ¤í„°HP
    };
}


function ì¥ë¹„ë“œëíŒì •(ëª¬ìŠ¤í„°, ìœ ì €) {
    const ê³ ì •ë“œë = {
        "ì¼ë°˜": { ì´ë¦„: "ë¦´ë¦¬íŠ¸ì˜ ë…ë‹ˆ", ê³µê²©ë ¥: 30 },
        "ë ˆì–´": { ì´ë¦„: "ë””ì•„ë¸”ë¡œì˜ ë¿”", ê³µê²©ë ¥: 63 },
        "ì‹ í™”": { ì´ë¦„: "ë ˆë¹„ì•„íƒ„ì˜ ë¹„ëŠ˜", ê³µê²©ë ¥: 132 },
        "ê³ ëŒ€": { ì´ë¦„: "ë²¨ì œë¶€ë¸Œì˜ ê¼¬ë¦¬", ê³µê²©ë ¥: 276 },
        "íƒœì´ˆ": { ì´ë¦„: "ì‚¬íƒ„ì˜ ë‚ ê°œ", ê³µê²©ë ¥: 576 },
        "íƒ€ë½": { ì´ë¦„: "ë£¨ì‹œí¼ì˜ ì‹¬ì¥", ê³µê²©ë ¥: 1200 },
    };

    const ë“œë = ê³ ì •ë“œë[ëª¬ìŠ¤í„°.íƒ€ì…];
    const ë“œëí™•ë¥  = 1; // ê¸°ë³¸ 100% ë“œë. ë‚˜ì¤‘ì— ì¡°ê±´ë¶€ë¡œ ë°”ê¿”ë„ ë¨

    if (!ë“œë || Math.random() > ë“œëí™•ë¥ ) return null;

    return {
        ì´ë¦„: ë“œë.ì´ë¦„,
        ê³µê²©ë ¥: ë“œë.ê³µê²©ë ¥,
        ë“±ê¸‰: ëª¬ìŠ¤í„°.íƒ€ì…,
        ê°•í™”: 0
    };
}

function ìœ ë¬¼ë“œëíŒì •(ëª¬ìŠ¤í„°, ìœ ì €) {
    // ìµœëŒ€ê°¯ìˆ˜ 99ê°œ ì´ˆê³¼í•œ ìœ ë¬¼ì€ ë“œë í›„ë³´ì—ì„œ ì œì™¸
    const í›„ë³´ìœ ë¬¼ = Object.keys(ì¼ë°˜ìœ ë¬¼ë°ì´í„°).filter(ìœ ë¬¼ì´ë¦„ => {
        const ë³´ìœ ëŸ‰ = (ìœ ì €.ìœ ë¬¼ëª©ë¡?.[ìœ ë¬¼ì´ë¦„] || 0);
        return ë³´ìœ ëŸ‰ < 99;
    });

    const ë“œëí™•ë¥  = 0.003;

    if (í›„ë³´ìœ ë¬¼.length > 0 && Math.random() < ë“œëí™•ë¥ ) {
        const ëœë¤ìœ ë¬¼ = í›„ë³´ìœ ë¬¼[Math.floor(Math.random() * í›„ë³´ìœ ë¬¼.length)];
        return ëœë¤ìœ ë¬¼;
    }

    return null; // ë“œë ì•ˆë¨
}

function ë³´ìƒê³„ì‚°(ì¸µ, ìœ ì €, ëª¬ìŠ¤í„°) {
    let ê²½í—˜ì¹˜ = 400;
    let ê°ì†Œìœ¨ = 0.2;
    for (let i = 1; i < ìœ ì €.ë ˆë²¨; i++) {
        ê²½í—˜ì¹˜ *= (1 - ê°ì†Œìœ¨);
        ê°ì†Œìœ¨ *= 0.9;
    }

    const ë³´ì •ê³„ìˆ˜ = 0.9 + Math.random() * 0.2;
    ê²½í—˜ì¹˜ = Math.floor(ê²½í—˜ì¹˜ * ë³´ì •ê³„ìˆ˜);

    let ê³¨ë“œ = Math.floor(Math.random() * 100) + (ì¸µ - 1) * 100;
    let ìˆ™ë ¨ë„ = Math.floor(ì¸µ * 1);

    let ì¶”ê°€ê³¨ë“œ = 0;
    let ì¶”ê°€ìˆ™ë ¨ë„ = 0;

    if (ëª¬ìŠ¤í„°.íƒ€ì… === "í™©ê¸ˆ") {
        ì¶”ê°€ê³¨ë“œ = ê³¨ë“œ * 19;
        ê³¨ë“œ *= 20;
    }

    if (ëª¬ìŠ¤í„°.íƒ€ì… === "ê³„ì‹œ") {
        ì¶”ê°€ìˆ™ë ¨ë„ = ìˆ™ë ¨ë„ * 19;
        ìˆ™ë ¨ë„ *= 20;
    }

    return { ê²½í—˜ì¹˜, ê³¨ë“œ, ìˆ™ë ¨ë„, ì¶”ê°€ê³¨ë“œ, ì¶”ê°€ìˆ™ë ¨ë„ };
}

function ë ˆë²¨ì—…íŒì •(í˜„ì¬ê²½í—˜ì¹˜, í˜„ì¬ë ˆë²¨) {
    const ìƒˆë ˆë²¨ = Math.floor(í˜„ì¬ê²½í—˜ì¹˜ / 1000) + 1;

    const ì¦ê°€ëŸ‰ = ìƒˆë ˆë²¨ - í˜„ì¬ë ˆë²¨;

    return {
        ìƒˆë ˆë²¨,
        ì¦ê°€í•œë ˆë²¨: ì¦ê°€ëŸ‰,
        ì¦ê°€í•œê³µê²©ë ¥: ì¦ê°€ëŸ‰ * 5
    };
}

function ë“œë ˆì¸íšŒë³µ(ìœ ì €) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ë“œë ˆì¸ë ˆë²¨ = ìŠ¤í‚¬["ë“œë ˆì¸"] || 0;

    // ë ˆë²¨ë§Œí¼ íšŒë³µ
    return ë“œë ˆì¸ë ˆë²¨;
}

function ì•„ì´ì–¸ë°”ë””íšŒë³µ(ìœ ì €) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ì•„ì´ì–¸ë ˆë²¨ = ìŠ¤í‚¬["ì•„ì´ì–¸ë°”ë””"] || 0;

    return ì•„ì´ì–¸ë ˆë²¨; // ê° ë ˆë²¨ë‹¹ +1 íšŒë³µ
}

function ì¸ì‚¬ì´íŠ¸ì¶”ê°€ìˆ™ë ¨ë„(ìœ ì €) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ì¸ì‚¬ì´íŠ¸ë ˆë²¨ = ìŠ¤í‚¬["ì¸ì‚¬ì´íŠ¸"] || 0;

    return ì¸ì‚¬ì´íŠ¸ë ˆë²¨; // ë ˆë²¨ 1ë‹¹ ì¶”ê°€ìˆ™ë ¨ë„ 1
}

function ì¸í…”ë¦¬ì „ìŠ¤ì¶”ê°€ê²½í—˜ì¹˜ë°°ìœ¨(ìœ ì €) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ì¸í…”ë¦¬ë ˆë²¨ = ìŠ¤í‚¬["ì¸í…”ë¦¬ì „ìŠ¤"] || 0;

    // ë ˆë²¨ë‹¹ 10% â†’ ê³±ì…ˆìš© 1.0 + ë ˆë²¨ * 0.1
    return 1 + ì¸í…”ë¦¬ë ˆë²¨ * 0.1;
}

function íšë“ê¸ˆí™”ë°œêµ´(ìœ ì €) {
    const ìŠ¤í‚¬ = ìœ ì €.ìŠ¤í‚¬ || {};
    const ë°œêµ´ë ˆë²¨ = ìŠ¤í‚¬["ë°œêµ´"] || 0;

    // ê° ë ˆë²¨ë‹¹ 10% ì¦ê°€ â†’ ê³±ì…ˆ ë°°ìœ¨ë¡œ 1.0 + (ë ˆë²¨ Ã— 0.1)
    return 1 + ë°œêµ´ë ˆë²¨ * 0.1;
}

function ì „íˆ¬ë³´ìƒë°˜ì˜(ìœ ì €, ë³´ìƒ, íšŒë³µëŸ‰, ë ˆë²¨ì—…ì •ë³´, ì „íˆ¬ì²´ë ¥) {
    const ìƒˆìœ ì € = { ...ìœ ì € };

    ìƒˆìœ ì €.ìœ ì €UID = ìœ ì €.ìœ ì €UID;
    ìƒˆìœ ì €.ê²½í—˜ì¹˜ += ë³´ìƒ.ê²½í—˜ì¹˜;
    ìƒˆìœ ì €.ê³¨ë“œ += ë³´ìƒ.ê³¨ë“œ;
    ìƒˆìœ ì €.ìˆ™ë ¨ë„ += ë³´ìƒ.ìˆ™ë ¨ë„;

    ìƒˆìœ ì €.ë ˆë²¨ += ë ˆë²¨ì—…ì •ë³´.ì¦ê°€í•œë ˆë²¨;
    ìƒˆìœ ì €.ë ˆë²¨ê³µê²©ë ¥ += ë ˆë²¨ì—…ì •ë³´.ì¦ê°€í•œê³µê²©ë ¥;
    ìƒˆìœ ì €.ë‚¨ì€ì²´ë ¥ = Math.min(
        ìƒˆìœ ì €.ìµœëŒ€ì²´ë ¥,
        ì „íˆ¬ì²´ë ¥ + íšŒë³µëŸ‰
    );

    return ìƒˆìœ ì €;
}

function ì¼ë°˜ì•…ë§ˆë¶ˆëŸ¬ì˜¤ê¸°(ì¸µ) {
    const ì¼ë°˜ëª¬ìŠ¤í„°ì´ë¦„ = [
        "ë””ë‚˜ë¥´", "ì—ë¦¬ê³¤", "ë„ë ˆì•Œ", "í¬ë¡œì…€", "ë£¨í˜ìŠ¤", "ë²¨", "ì‹œì—ë¥´", "ì„¸ë ˆìš°ìŠ¤", "ë²„ì•Œë² ë¦¬ìŠ¤", "ë°œë¼í¬",
        "ë¡œë…¸ë² ", "ìê°„", "ì•ˆë“œë¼ë©œë¦¬ìš°ìŠ¤", "ë‹ˆë² ë¡œìŠ¤", "ì—ì´ëª¬", "ë¼ì—ìŠ¤", "ì•„ë¼íƒ€ë°”", "ë°”í‹°ë°”ìŠ¤", "ì•„ëª¬", "ì•ˆë“œë¡œë§ë¦¬ìš°ìŠ¤",
        "ë°”í”¼ë©”íŠ¸", "ì˜¤ë¡œì´ì•„ìŠ¤", "ì˜¤ì„¸", "ì•„ë¯¸", "ë°ì¹´ë¸Œë¦¬ì•„", "ë²¨ë¦¬ì•Œ", "ë””ì¹´ë¦¬ë¸Œ", "ì„¸ì´ë¥´", "ì˜¤ë¡œë²„ìŠ¤", "ë¬´ë£¨ë¬´ë¥´",
        "ì¹´ì´ë¯¸", "ì•Œë¡œì„¸ìŠ¤", "ìƒ¤ë¥´ë‚˜í¬", "ìƒ¤í¬", "ì‚¬ë¸Œë‚™", "ë¼í•˜ë¸Œ", "ë§í¬ë¥´ìŠ¤", "í•˜ìš°ë ˆìŠ¤", "í”¼ë‹‰ìŠ¤", "ë¶€ì•Œ",
        "í‘¸ë¥´ì¹´ìŠ¤", "ê°€í”„", "ì•„ìŠ¤ëª¨ë°ìš°ìŠ¤", "í¬ë¥´ì¹´ìŠ¤", "ë³´ë½ìŠ¤", "ê¸€ë¼ì‹œì•„ë¼ë³¼ë¼ìŠ¤", "ë‚˜ë² ë¦¬ìš°ìŠ¤", "ì•„ì´ëª¬", "í”„ë£¨í‘¸ìŠ¤", "ì‚´ë¡œìŠ¤",
        "í•˜í”„ë¦¬", "í˜ë‹ˆì•…ìŠ¤", "ë‹¤ì´ëª¬", "ìŠ¤í‹¸", "ë§ˆë¥´ì½”ì‹œì•„ìŠ¤", "ë³´íŠ¸ìŠ¤", "ì œíŒŒë¥´", "ì—˜ë¦¬ê³ ìŠ¤", "ë ˆë¦¬ì–´", "ë² ë ˆíŠ¸",
        "ì‹œíŠ¸ë¦¬", "êµ¬ì‹œì˜¨", "ë¶€ì—ë¥´", "ì¹´ì„", "í¬ë¥´ë„¤ìš°ìŠ¤", "ë¶€ë„¤", "ì•„ëª¬", "ë§ˆë¼ë°”ìŠ¤", "í‘¸ë¥´ì†", "ë§íŒŒìŠ¤",
        "íŒŒì„", "ë°”ë¥´ë°”í† ìŠ¤"
    ];

    const ëœë¤ê°€ì¤‘ì¹˜ = () => (Math.random() * 0.2 + 0.9); // 0.9 ~ 1.1 ëœë¤

    const ì¼ë°˜ëª©ë¡ = ì¼ë°˜ëª¬ìŠ¤í„°ì´ë¦„.map((ì´ë¦„, i) => {
        const ê¸°ì¤€ì²´ë ¥ = ì¸µ === 1 ? 30 : 30 * Math.pow(10, ì¸µ - 1);
        const ê¸°ì¤€ë°©ì–´ë ¥ = ì¸µ === 1 ? 1 : Math.pow(10, ì¸µ - 1);

        return {
            ì´ë¦„,
            ì²´ë ¥: Math.floor(ê¸°ì¤€ì²´ë ¥ * ëœë¤ê°€ì¤‘ì¹˜()),
            ë°©ì–´ë ¥: Math.floor(ê¸°ì¤€ë°©ì–´ë ¥ * ëœë¤ê°€ì¤‘ì¹˜()),
            íƒ€ì…: "ì¼ë°˜"
        };
    });

    const ê¸°ì¤€ëª¬ìŠ¤í„° = ì¼ë°˜ëª©ë¡[Math.floor(Math.random() * ì¼ë°˜ëª©ë¡.length)];

    return ê¸°ì¤€ëª¬ìŠ¤í„°;
}

function ë ˆì–´ì•…ë§ˆë¶ˆëŸ¬ì˜¤ê¸°(ì¸µ, ì´ë¦„) {
    const ì´ë¦„ë§µ = {
        "ë£¨ì‹œí¼": { ì²´ë ¥ê³„ìˆ˜: 3.2, ë°©ì–´ê³„ìˆ˜: 1.6, íƒ€ì…: "íƒ€ë½" },
        "ì‚¬íƒ„": { ì²´ë ¥ê³„ìˆ˜: 2.0, ë°©ì–´ê³„ìˆ˜: 1.5, íƒ€ì…: "íƒœì´ˆ" },
        "ë²¨ì œë¶€ë¸Œ": { ì²´ë ¥ê³„ìˆ˜: 1.8, ë°©ì–´ê³„ìˆ˜: 1.4, íƒ€ì…: "ê³ ëŒ€" },
        "ë ˆë¹„ì•„íƒ„": { ì²´ë ¥ê³„ìˆ˜: 1.6, ë°©ì–´ê³„ìˆ˜: 1.3, íƒ€ì…: "ì‹ í™”" },
        "ë””ì•„ë¸”ë¡œ": { ì²´ë ¥ê³„ìˆ˜: 1.2, ë°©ì–´ê³„ìˆ˜: 1.1, íƒ€ì…: "ë ˆì–´" },
        "ë¦´ë¦¬íŠ¸": { ì²´ë ¥ê³„ìˆ˜: 1, ë°©ì–´ê³„ìˆ˜: 1, íƒ€ì…: "ì¼ë°˜" },
        "ìˆ™ê³ ë¸”ë¦°": { ì²´ë ¥ê³„ìˆ˜: 1.4, ë°©ì–´ê³„ìˆ˜: 1.2, íƒ€ì…: "ê³„ì‹œ" },
        "í™©ê¸ˆê³ ë¸”ë¦°": { ì²´ë ¥ê³„ìˆ˜: 0.8, ë°©ì–´ê³„ìˆ˜: 0.8, íƒ€ì…: "í™©ê¸ˆ" },
    };

    const ì„¤ì • = ì´ë¦„ë§µ[ì´ë¦„];
    if (!ì„¤ì •) return null;

    const ê¸°ì¤€ì²´ë ¥ = ì¸µ === 1 ? 30 : 30 * Math.pow(10, ì¸µ - 1);
    const ê¸°ì¤€ë°©ì–´ë ¥ = ì¸µ === 1 ? 1 : Math.pow(10, ì¸µ - 1);

    const ëœë¤ê°€ì¤‘ì¹˜ = () => (Math.random() * 0.2 + 0.9);

    return {
        ì´ë¦„,
        ì²´ë ¥: Math.floor(ê¸°ì¤€ì²´ë ¥ * ì„¤ì •.ì²´ë ¥ê³„ìˆ˜ * ëœë¤ê°€ì¤‘ì¹˜()),
        ë°©ì–´ë ¥: Math.floor(ê¸°ì¤€ë°©ì–´ë ¥ * ì„¤ì •.ë°©ì–´ê³„ìˆ˜ * ëœë¤ê°€ì¤‘ì¹˜()),
        íƒ€ì…: ì„¤ì •.íƒ€ì…
    };
}

function ìµœì¢…ê³µê²©ë ¥ê³„ì‚°(ìœ ì €) {
    const ë ˆë²¨ê³µê²©ë ¥ = ìœ ì €.ë ˆë²¨ê³µê²©ë ¥ || 10;
    const ì¥ë¹„ê³µê²©ë ¥ = ìœ ì €.ì¥ë¹„ê³µê²©ë ¥ || 0;
    const ì „ì§ê³µê²©ë ¥ = ìœ ì €.ì „ì§ê³µê²©ë ¥ || 1;
    const í«ë‹¨ê³„ì›ë³¸ = ìœ ì €.í«ë‹¨ê³„ || 0;
    const í«ë°°ìœ¨ = 1 + 0.1 * í«ë‹¨ê³„ì›ë³¸;
    const ì†Œë“œê°œìˆ˜ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ì†Œë“œ"] || 0;

    const ìµœì¢…ê³µê²©ë ¥ = (ë ˆë²¨ê³µê²©ë ¥ + ì¥ë¹„ê³µê²©ë ¥)
        * (ì „ì§ê³µê²©ë ¥ * 0.1 + 0.9)
        * (1 + 0.01 * ì†Œë“œê°œìˆ˜)
        * í«ë°°ìœ¨;

    return Math.round(ìµœì¢…ê³µê²©ë ¥);
}

function ìµœëŒ€ì²´ë ¥ê³„ì‚°(ìœ ì €) {
    const í•©ì„±ê¸°ë¡ = ìœ ì €.í•©ì„±ê¸°ë¡ || {};

    // âœ… "íƒœì´ˆ" ë˜ëŠ” "íƒ€ë½" ë“±ê¸‰ë§Œ í•„í„°ë§í•˜ì—¬ í•©ì‚°
    const ì´í•©ì„±íšŸìˆ˜ = Object.entries(í•©ì„±ê¸°ë¡)
        .filter(([í‚¤, _]) => í‚¤.includes("|íƒœì´ˆ") || í‚¤.includes("|íƒ€ë½"))
        .reduce((í•©, [_, ê°’]) => í•© + ê°’, 0);

    const í•˜íŠ¸ê°œìˆ˜ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["í•˜íŠ¸í”ŒëŸ¬ìŠ¤"] || 0;
    const ë³´ì • = 1 + 0.01 * í•˜íŠ¸ê°œìˆ˜;

    return Math.round((10 + ì´í•©ì„±íšŸìˆ˜) * ë³´ì •);
}


function ë ˆì–´ëª¬ìŠ¤í„°ë“±ì¥íŒì •(ìœ ì €) {
    const ê³ ìŠ¤íŠ¸ê°œìˆ˜ = ìœ ì €.ìœ ë¬¼ëª©ë¡?.["ê³ ìŠ¤íŠ¸"] || 0;
    const ë³´ì • = 1 + 0.01 * ê³ ìŠ¤íŠ¸ê°œìˆ˜;

    const í›„ë³´ = [
        { ì´ë¦„: "ë£¨ì‹œí¼", í™•ë¥ : ë³´ì • * (1 / 25600) },
        { ì´ë¦„: "ì‚¬íƒ„", í™•ë¥ : ë³´ì • * (1 / 12800) },
        { ì´ë¦„: "ë²¨ì œë¶€ë¸Œ", í™•ë¥ : ë³´ì • * (1 / 6400) },
        { ì´ë¦„: "ë ˆë¹„ì•„íƒ„", í™•ë¥ : ë³´ì • * (1 / 3200) },
        { ì´ë¦„: "ë””ì•„ë¸”ë¡œ", í™•ë¥ : ë³´ì • * (1 / 1600) },
        { ì´ë¦„: "ë¦´ë¦¬íŠ¸", í™•ë¥ : ë³´ì • * (1 / 800) },
        { ì´ë¦„: "ìˆ™ê³ ë¸”ë¦°", í™•ë¥ : ë³´ì • * (1 / 200) },
        { ì´ë¦„: "í™©ê¸ˆê³ ë¸”ë¦°", í™•ë¥ : ë³´ì • * (1 / 200) },
    ];

    // const í›„ë³´ = [
    //     { ì´ë¦„: "ë£¨ì‹œí¼", í™•ë¥ : ë³´ì • * (1 / 25600) },
    //     { ì´ë¦„: "ì‚¬íƒ„", í™•ë¥ : ë³´ì • * (1 / 12800) },
    //     { ì´ë¦„: "ë²¨ì œë¶€ë¸Œ", í™•ë¥ : ë³´ì • * (1 / 6400) },
    //     { ì´ë¦„: "ë ˆë¹„ì•„íƒ„", í™•ë¥ : ë³´ì • * (1 / 3200) },
    //     { ì´ë¦„: "ë””ì•„ë¸”ë¡œ", í™•ë¥ : ë³´ì • * (1 / 1600) },
    //     { ì´ë¦„: "ë¦´ë¦¬íŠ¸", í™•ë¥ : 1 },
    //     { ì´ë¦„: "ìˆ™ê³ ë¸”ë¦°", í™•ë¥ : ë³´ì • * (1 / 200) },
    //     { ì´ë¦„: "í™©ê¸ˆê³ ë¸”ë¦°", í™•ë¥ : ë³´ì • * (1 / 200) },
    // ];


    // â›”ï¸ ëª¨ë“  í™•ë¥  í•©ê³„
    const ì´í•© = í›„ë³´.reduce((í•©, í•­ëª©) => í•© + í•­ëª©.í™•ë¥ , 0);
    const ë‚¨ì€í™•ë¥  = Math.max(0, 1 - ì´í•©);  // null í™•ë¥ 

    if (ë‚¨ì€í™•ë¥  > 0) í›„ë³´.push({ ì´ë¦„: null, í™•ë¥ : ë‚¨ì€í™•ë¥  });

    const r = Math.random();
    let ëˆ„ì  = 0;
    for (const í•­ëª© of í›„ë³´) {
        ëˆ„ì  += í•­ëª©.í™•ë¥ ;
        if (r < ëˆ„ì ) return í•­ëª©.ì´ë¦„;
    }
    return null;
}

const ì¼ë°˜ìœ ë¬¼ë°ì´í„° = {
    "ì†Œë“œ": { ì„¤ëª…: "ê³µê²©ë ¥ì´ ì¦ê°€í•©ë‹ˆë‹¤(*1%)" },
    "í•˜íŠ¸í”ŒëŸ¬ìŠ¤": { ì„¤ëª…: "ì²´ë ¥ì´ ì¦ê°€í•©ë‹ˆë‹¤(*1%)" },
    "ê³ ìŠ¤íŠ¸": { ì„¤ëª…: "íˆë“ ëª¬ìŠ¤í„° ë“±ì¥ë¥ ì´ ì¦ê°€í•©ë‹ˆë‹¤(*1%)" },
    "ì‰´ë“œë°´": { ì„¤ëª…: "ì•…ë§ˆë“¤ì˜ ë°©ì–´ë ¥ì„ ê°ì†Œì‹œí‚µë‹ˆë‹¤(*1%)" },
    "í•˜íŠ¸ë§ˆì´ë„ˆìŠ¤": { ì„¤ëª…: "ì•…ë§ˆë“¤ì˜ ì²´ë ¥ì„ ê°ì†Œì‹œí‚µë‹ˆë‹¤(*0.1%)" },
    "í´ë¡œë²„": { ì„¤ëª…: "ë„ë°•í™•ë¥ ì´ ì¦ê°€í•©ë‹ˆë‹¤(*0.1%)" },
    "ëª¨ë˜ì‹œê³„": { ì„¤ëª…: "ìŠ¤íƒœë¯¸ë„ˆ ì†Œëª¨ë¥¼ ë¬´ì‹œí•©ë‹ˆë‹¤(0.1%)" },
    "ì•”í¬ë¼": { ì„¤ëª…: "ë³´ìŠ¤ì „ ìŠ¤íƒœë¯¸ë„ˆ ì†Œëª¨ëŸ‰ì„ ê°ì†Œì‹œí‚µë‹ˆë‹¤(0.1%)" },
    "í¼ì¦": { ì„¤ëª…: "ë„ë°•ë¹„ìš©ì„ ë¬´ì‹œí•©ë‹ˆë‹¤(0.1%)" },
};
const ë ˆì–´ìœ ë¬¼ë°ì´í„° = {
    "ì†Œë“œ": { ì„¤ëª…: "ê³µê²©ë ¥ì´ ì¦ê°€í•©ë‹ˆë‹¤(*1%)" },
    "í•˜íŠ¸í”ŒëŸ¬ìŠ¤": { ì„¤ëª…: "ì²´ë ¥ì´ ì¦ê°€í•©ë‹ˆë‹¤(*1%)" },
    "ê³ ìŠ¤íŠ¸": { ì„¤ëª…: "íˆë“ ëª¬ìŠ¤í„° ë“±ì¥ë¥ ì´ ì¦ê°€í•©ë‹ˆë‹¤(*1%)" },
    "ì‰´ë“œë°´": { ì„¤ëª…: "ì•…ë§ˆë“¤ì˜ ë°©ì–´ë ¥ì„ ê°ì†Œì‹œí‚µë‹ˆë‹¤(*1%)" },
    "í•˜íŠ¸ë§ˆì´ë„ˆìŠ¤": { ì„¤ëª…: "ì•…ë§ˆë“¤ì˜ ì²´ë ¥ì„ ê°ì†Œì‹œí‚µë‹ˆë‹¤(*0.1%)" },
    "í´ë¡œë²„": { ì„¤ëª…: "ë„ë°•í™•ë¥ ì´ ì¦ê°€í•©ë‹ˆë‹¤(*0.1%)" },
    "ëª¨ë˜ì‹œê³„": { ì„¤ëª…: "ìŠ¤íƒœë¯¸ë„ˆ ì†Œëª¨ë¥¼ ë¬´ì‹œí•©ë‹ˆë‹¤(0.1%)" },
    "ì•”í¬ë¼": { ì„¤ëª…: "ë³´ìŠ¤ì „ ìŠ¤íƒœë¯¸ë„ˆ ì†Œëª¨ëŸ‰ì„ ê°ì†Œì‹œí‚µë‹ˆë‹¤(0.1%)" },
    "í¼ì¦": { ì„¤ëª…: "ë„ë°•ë¹„ìš©ì„ ë¬´ì‹œí•©ë‹ˆë‹¤(0.1%)" },
    "í”Œë¼ì›Œ": { ì„¤ëª…: "ìŠ¤í‚¬ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤" },
    "í‹°ì¼“": { ì„¤ëª…: "ê³ ê¸‰ì¥ë¹„ë„ë°•ì— ì‚¬ìš©ë©ë‹ˆë‹¤" },
    "ìƒëŸ¬ë“œ": { ì„¤ëª…: "ìŠ¤íƒœë¯¸ë„ˆë¥¼ ì¶©ì „í•©ë‹ˆë‹¤(+60)" },
};

// ğŸŸ¡ ì •ì  íŒŒì¼ ê²½ë¡œ ì„¤ì •
app.use(express.static(path.join(__dirname)));

